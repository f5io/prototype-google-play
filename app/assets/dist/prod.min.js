!function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return r(n?n:t)},l,l.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t){function e(){var t=250,e=t/2,l=2*t+50,h=n('[role="container"]')[0],f=(n('[role="phone"]')[0],n('[role="light"]')[0]),d=n('[role="main"]')[0],p=n('[role="cube"]')[0],v=n('[role="loader"]')[0],m=n('[role="background"]')[0];h.style[n.CSS_PERSPECTIVE]=l+"px";var _=i.global.isCeltra?"http://labs.f5.io/essence/":"";a.add([_+"assets/sound/click.mp3",_+"assets/img/playlogo-sml.png",_+"assets/img/cubes/main/side1.jpg",_+"assets/img/cubes/main/side2.jpg",_+"assets/img/cubes/main/side3.jpg",_+"assets/img/cubes/main/side4.jpg",_+"assets/img/cubes/main/side5.jpg",_+"assets/img/cubes/main/side6.jpg"]).preload().then(function(){function a(){for(var i=[],s=0;4>s;s++){var a=n.getElement("div","cube-container",{},{});p.appendChild(a);var u=Object.create(r);u.init(e,e,s,"cube0"+(s+1),a,{cropLargeFaces:!0,castShadow:!1}),j[u.id]=u,u.element.style.left=n.isOdd(s+1)?"-"+e+"px":e+"px",u.element.style.top=2>s?"-"+e+"px":e+"px",u.render(),u.config.normaliseFacialRotation&&u.getNormalisedFaceRotation(u.rotation),_(u,s),i.push(u)}y=Object.create(o),y.init(t,t,0,"shadow",p),y.render(),g(),c.defineCubeProperties(i)}function l(){var e=n.getElement("div","cube-container",{},{});p.appendChild(e),b=Object.create(r),b.init(t,t,0,"main",e,{useInertia:!0,useBackgrounds:!0,useContent:!1,isSequential:!1,normaliseFacialRotation:!0}),b.rotation=w||b.rotation,b.getNormalisedFaceRotation(b.rotation,!0),b.render(),c.defineCubeProperties([b])}function h(){p.innerHTML="",j={}}function _(t,e){function r(){if(!(--s<0)){var o,a,c=n.range(0,100)<50?!0:!1,l=t.getAxisDefinition(t.rotation),h=c?l.UD:l.LR,f=2!==s||0!==e&&3!==e?200:0;u.tween().delay(f).duration(300).from(0).to(90).ease(u.easing.easeOutCirc).step(function(e){a=a||e;var r=n.nearest(e,90),s=n.nearest(a,90);r!==s&&i.global.useSound&&t.sound.play(),t.rotation[h]=o+e,t.render(),a=e}).complete(function(){t.config.normaliseFacialRotation&&t.getNormalisedFaceRotation(t.rotation),r()}).start(function(){o=t.rotation[h]})}}var o=t.target,s=3,a=-n.windowHeight(),c=0;o.style[n.CSS_TRANSFORM]+=" translateY("+a+"px)",u.tween().delay(200*(4-e)).from(a).to(c).ease(u.easing[2>e?"easeOutCirc":"easeOutBack"]).step(function(t){o.style[n.CSS_TRANSFORM]=o.style[n.CSS_TRANSFORM].replace(/translateY\(.+\)/g,function(){return"translateY("+t+"px)"})}).complete(r).start()}function g(){y.scale.X=y.scale.Y=y.opacity=0;var t=0,e=1;u.tween().duration(400).from(t).to(e).ease(u.easing.easeOutBack).step(function(t){y.scale.X=y.scale.Y=t,y.opacity=t/10,y.render()}).start()}v.className="off";var y,b,w,j={};c.init(),n.emitter.on("debug_panel",function(t){d.classList[t?"add":"remove"]("covered")});var x=Object.create(s);x.init(m),i.global.useGamification?a():l(),n.emitter.on("global_config_change",function(t,e){"useGamification"===t&&(h(),e?a():l())}),n.emitter.on("rotation_complete",function(){var t=Object.keys(j).map(function(t){return j[t]}),e=t.some(function(t){return t.config.normaliseFacialRotation});f.style.display="none";var r=t.map(function(t){var e=t.element,n=e.offsetLeft+e.offsetWidth/2,i=e.offsetTop+e.offsetHeight/2,r=t.getFaceFromTarget(document.elementFromPoint(n,i));return{face:r,cube:t}});f.style.display="block";var o=!1,s=!1;o=r.every(function(t,e,n){if(0===e)return!0;var i=n[e-1].face,r=t.face;return i.index===r.index}),o&&!e&&(s=r.every(function(t){var e=t.cube.rotation,n=t.face.index,i=t.cube.getNormalisedFaceRotation(e,n);return 0===i})),o&&(s||e)&&(w=n.clone(t[0].rotation),i.global.useGamification=!1)}),n.emitter.on("fold_out_complete",function(t){w=n.clone(t),i.global.useGamification=!1}),n.emitter.on("fold_out_start",function(t,e){var i=j[Object.keys(j).filter(function(e){return j[e].index===t})[0]];i.faces.map(function(t){return n(".shadow",t.element)[0]}).forEach(function(t){u.tween().from(0).to(1).duration(e).step(function(e){t.style.opacity=e}).start()})}),document.addEventListener("touchmove",n.prevent)})}var n=t("./modules/utilities"),i=t("./modules/config"),r=t("./modules/cube"),o=t("./modules/cube/shadow"),s=(t("./modules/orient"),t("./modules/messaging"),t("./modules/background")),a=t("./modules/assetmanager"),c=t("./modules/debug"),u=(t("./modules/phone"),t("stats"),t("interpol"));n.isDefined(window.screen)&&n.isDefined(window.creative)?(i.global.isCeltra=!0,window.InitCube=e):n.ready(e)},{"./modules/assetmanager":41,"./modules/background":45,"./modules/config":46,"./modules/cube":51,"./modules/cube/shadow":53,"./modules/debug":55,"./modules/messaging":56,"./modules/orient":57,"./modules/phone":58,"./modules/utilities":59,interpol:2,stats:3}],2:[function(t,e){(function(n){__browserify_shim_require__=t,function(t,e,n,i,r){!function(e){"undefined"!=typeof t&&t.exports?t.exports=e(window):self.Interpol=self.iN=e(window)}(function(t){"use strict";var e={};e.fps=60,e.easing={easeNone:function(t,e,n,i){return n*t/i+e},easeInQuad:function(t,e,n,i){return n*(t/=i)*t+e},easeOutQuad:function(t,e,n,i){return-n*(t/=i)*(t-2)+e},easeInOutQuad:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,n,i){return n*(t/=i)*t*t+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeInOutCubic:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,n,i){return n*(t/=i)*t*t*t+e},easeOutQuart:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},easeOutQuint:function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e},easeOutSine:function(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e},easeInOutSine:function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e},easeInExpo:function(t,e,n,i){return 0==t?e:n*Math.pow(2,10*(t/i-1))+e},easeOutExpo:function(t,e,n,i){return t==i?e+n:n*(-Math.pow(2,-10*t/i)+1)+e},easeInOutExpo:function(t,e,n,i){return 0==t?e:t==i?e+n:(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(-Math.pow(2,-10*--t)+2)+e},easeInCirc:function(t,e,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+e},easeOutCirc:function(t,e,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+e},easeInOutCirc:function(t,e,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,n,i){var r=1.70158,o=0,s=n;if(0==t)return e;if(1==(t/=i))return e+n;if(o||(o=.3*i),s<Math.abs(n)){s=n;var r=o/4}else var r=o/(2*Math.PI)*Math.asin(n/s);return-(s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*i-r)*Math.PI/o))+e},easeOutElastic:function(t,e,n,i){var r=1.70158,o=0,s=n;if(0==t)return e;if(1==(t/=i))return e+n;if(o||(o=.3*i),s<Math.abs(n)){s=n;var r=o/4}else var r=o/(2*Math.PI)*Math.asin(n/s);return s*Math.pow(2,-10*t)*Math.sin(2*(t*i-r)*Math.PI/o)+n+e},easeInOutElastic:function(t,e,n,i){var r=1.70158,o=0,s=n;if(0==t)return e;if(2==(t/=i/2))return e+n;if(o||(o=.3*i*1.5),s<Math.abs(n)){s=n;var r=o/4}else var r=o/(2*Math.PI)*Math.asin(n/s);return 1>t?-.5*s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*i-r)*Math.PI/o)+e:s*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*i-r)*Math.PI/o)*.5+n+e},easeInBack:function(t,e,n,i,r){return void 0==r&&(r=1.70158),n*(t/=i)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,n,i,r){return void 0==r&&(r=1.70158),n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,n,i,r){return void 0==r&&(r=1.70158),(t/=i/2)<1?n/2*t*t*(((r*=1.525)+1)*t-r)+e:n/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e},easeInBounce:function(t,e,n,i){return n-this.easeOutBounce(i-t,0,n,i)+e},easeOutBounce:function(t,e,n,i){return(t/=i)<1/2.75?7.5625*n*t*t+e:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,e,n,i){return i/2>t?.5*this.easeInBounce(2*t,0,n,i)+e:.5*this.easeOutBounce(2*t-i,0,n,i)+.5*n+e}},e.rafLast=0,e.requestAnimFrame=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-e.rafLast)),r=window.setTimeout(function(){t(n+i)},i);return e.rafLast=n+i,r}}(),e.cancelAnimFrame=function(){return t.cancelAnimationFrame||t.cancelRequestAnimationFrame||t.webkitCancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelAnimationFrame||t.mozCancelRequestAnimationFrame||function(t){clearTimeout(t)}}(),e.noop=function(){},e.tick=function(){var n=this;return function(){if(n.raf=e.requestAnimFrame.call(t,e.tick.call(n)),n.now=(new Date).getTime(),n.delta=n.now-n.then,n.delta>n.interval){for(var i=Object.keys(n.pipeline),r=i.length,o=0;r>o;o++)n.pipeline[i[o]]();n.then=n.now-n.delta%n.interval}}},e.FramePipeline=function(){var t=this;t.pipeline={},t.then=(new Date).getTime(),t.now=void 0,t.raf=void 0,t.delta=void 0,t.interval=1e3/e.fps},e.FramePipeline.prototype={add:function(t,e){this.pipeline[t]=e},remove:function(t){delete this.pipeline[t]},start:function(){e.tick.call(this)()},has:function(t){return t in this.pipeline},pause:function(){e.cancelAnimFrame.call(t,this.raf)},setFPS:function(t){this.interval=1e3/t}},e.pipeline=new e.FramePipeline,e.pipeline.start(),e.TweenController=function(){this.q=[]},e.TweenController.prototype={queue:function(){var t=new e.Tween(this),n=this.q[this.q.length-1];return!n||n&&n.hasCompleted?t.canStart=!0:(t.canStart=!1,n.then(function(){t.canStart=!0,t.start()})),this.q.push(t),t}},e.Tween=function(t){var n=this;n.name="$interpol-"+parseInt(Math.random()*(new Date).getTime()),n.controller=t||new e.TweenController,n.startVal=0,n.endVal=0,n.differences={},n.canStart=!0,n.hasStarted=!1,n.hasCompleted=!1,n.tweenDuration=400,n.delayDuration=0,n.isDelayed=!1,n.repeatCount=0,n.paused=!1,n.easing=e.easing.easeNone,n.onStep=e.noop,n.onComplete=e.noop,n.onStopped=e.noop,n.andThen=e.noop},e.Tween.prototype={from:function(t){return this.startVal=t,this},to:function(t){return this.endVal=t,this},duration:function(t){return this.tweenDuration=t,this},delay:function(t){return this.delayDuration=t,this},repeat:function(t){return this.repeatCount=t,this},ease:function(t){return this.easing=t,this},step:function(t){return this.onStep=t,this},complete:function(t){return this.onComplete=t,this},stopped:function(t){return this.onStopped=t,this},then:function(t){return this.andThen=t,this},reverse:function(){var t=this.startVal,e=this.endVal;this.startVal=e,this.endVal=t,this.start()},start:function(t){var n=this;if(!n.canStart)return n;if(n.delayDuration>0&&!n.isDelayed)return setTimeout(function(){n.start(t)},n.delayDuration),n.isDelayed=!0,n;t&&t.apply(n);var i=1e3/e.fps,r=n.tweenDuration/i;if("object"==typeof n.endVal){"object"!=typeof n.startVal&&(n.startVal={});for(var o in n.endVal)n.startVal.hasOwnProperty(o)||(n.startVal[o]=0),n.differences[o]=n.endVal[o]-n.startVal[o]}else n.differences["$itp-main"]=n.endVal-n.startVal;return n.hasStarted=!0,n.stpFn=function(){if(r>=0&&n.hasStarted){var t=n.tweenDuration;t-=r*i,r--;var o=n.differences.hasOwnProperty("$itp-main")?n.easing.call(e.easing,t,n.startVal,n.differences["$itp-main"],n.tweenDuration):{};if("object"==typeof o)for(var s in n.differences)o[s]=n.easing.call(e.easing,t,n.startVal[s],n.differences[s],n.tweenDuration);n.onStep.call(n,o)}else n.hasStarted?(e.pipeline.remove(n.name),n.hasStarted=!1,n.isDelayed=!1,n.repeatCount>0||-1===n.repeatCount||1/0===n.repeatCount?(n.repeatCount=n.repeatCount<0||1/0===n.repeatCount?n.repeatCount:n.repeatCount--,n.onComplete.call(n,n.endVal),n.start()):(n.hasCompleted=!0,n.onComplete.call(n,n.endVal),n.andThen.call(n),n.controller.q.shift())):(e.pipeline.remove(n.name),n.onStopped.call(n))},e.pipeline.add(n.name,n.stpFn),n},stop:function(){return this.hasStarted=!1,this},pause:function(){return e.pipeline.remove(this.name),this},play:function(){return e.pipeline.has(this.name)?void 0:(e.pipeline.add(this.name,this.stpFn),this)},queue:function(){return this.controller.queue()}};var n=function(t){return e.fps=t,e.pipeline.setFPS(e.fps),n};return n.easing=e.easing,n.tween=function(){return new e.Tween},n.queue=function(){return(new e.TweenController).queue()},n.pipeline=e.pipeline,n}),r("undefined"!=typeof Interpol?Interpol:window.Interpol)}.call(n,void 0,void 0,void 0,void 0,function(t){e.exports=t})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e){(function(n){__browserify_shim_require__=t,function(t,e,n,i,r){var o=function(){var t=Date.now(),e=t,n=0,i=1/0,r=0,o=0,s=1/0,a=0,c=0,u=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(t){t.preventDefault(),g(++u%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var h=document.createElement("div");h.id="fps",h.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(h);var f=document.createElement("div");f.id="fpsText",f.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.innerHTML="FPS",h.appendChild(f);var d=document.createElement("div");for(d.id="fpsGraph",d.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",h.appendChild(d);d.children.length<74;){var p=document.createElement("span");p.style.cssText="width:1px;height:30px;float:left;background-color:#113",d.appendChild(p)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var m=document.createElement("div");m.id="msText",m.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="MS",v.appendChild(m);var _=document.createElement("div");for(_.id="msGraph",_.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",v.appendChild(_);_.children.length<74;){var p=document.createElement("span");p.style.cssText="width:1px;height:30px;float:left;background-color:#131",_.appendChild(p)}var g=function(t){switch(u=t){case 0:h.style.display="block",v.style.display="none";break;case 1:h.style.display="none",v.style.display="block"}},y=function(t,e){var n=t.appendChild(t.firstChild);n.style.height=e+"px"};return{REVISION:11,domElement:l,setMode:g,begin:function(){t=Date.now()},end:function(){var u=Date.now();return n=u-t,i=Math.min(i,n),r=Math.max(r,n),m.textContent=n+" MS ("+i+"-"+r+")",y(_,Math.min(30,30-n/200*30)),c++,u>e+1e3&&(o=Math.round(1e3*c/(u-e)),s=Math.min(s,o),a=Math.max(a,o),f.textContent=o+" FPS ("+s+"-"+a+")",y(d,Math.min(30,30-o/100*30)),e=u,c=0),u},update:function(){t=this.end()}}};r("undefined"!=typeof o?o:window.Stats)}.call(n,void 0,void 0,void 0,void 0,function(t){e.exports=t})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e){"use strict";e.exports=function(t){function e(t){var e=new n(t),i=e.promise();return i.isRejected()?i:(e.setHowMany(1),e.setUnwrap(),e.init(),i)}var n=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],5:[function(t,e){(function(n){"use strict";function i(){this._isTickUsed=!1,this._schedule=r,this._length=0,this._lateBuffer=new o(16),this._functionBuffer=new o(65536);var t=this;this.consumeFunctionBuffer=function(){t._consumeFunctionBuffer()}}var r=t("./schedule.js"),o=t("./queue.js"),s=t("./util.js").errorObj,a=t("./util.js").tryCatch1,c="undefined"!=typeof n?n:void 0;i.prototype.haveItemsQueued=function(){return this._length>0},i.prototype.invokeLater=function(t,e,n){void 0===c||null==c.domain||t.domain||(t=c.domain.bind(t)),this._lateBuffer.push(t,e,n),this._queueTick()},i.prototype.invoke=function(t,e,n){void 0===c||null==c.domain||t.domain||(t=c.domain.bind(t));var i=this._functionBuffer;i.push(t,e,n),this._length=i.length(),this._queueTick()},i.prototype._consumeFunctionBuffer=function(){for(var t=this._functionBuffer;t.length()>0;){var e=t.shift(),n=t.shift(),i=t.shift();e.call(n,i)}this._reset(),this._consumeLateBuffer()},i.prototype._consumeLateBuffer=function(){for(var t=this._lateBuffer;t.length()>0;){var e=t.shift(),n=t.shift(),i=t.shift(),r=a(e,n,i);if(r===s){if(this._queueTick(),null==e.domain)throw r.e;e.domain.emit("error",r.e)}}},i.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},i.prototype._reset=function(){this._isTickUsed=!1,this._length=0},e.exports=new i}).call(this,t("_process"))},{"./queue.js":28,"./schedule.js":31,"./util.js":38,_process:39}],6:[function(t,e){"use strict";var n=t("./promise.js")();e.exports=n},{"./promise.js":23}],7:[function(t,e){"use strict";var n=Object.create;if(n){var i=n(null),r=n(null);i[" size"]=r[" size"]=0}e.exports=function(e){function n(t){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,t))}function o(t){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",t))}function s(t,e,n){var i=n[t];if("function"!=typeof i){if(!p(t))return null;if(i=e(t),n[t]=i,n[" size"]++,n[" size"]>512){for(var r=Object.keys(n),o=0;256>o;++o)delete n[r[o]];n[" size"]=r.length-256}}return i}function a(t){return s(t,n,i)}function c(t){return s(t,o,r)}function u(t){return t[this.pop()].apply(t,this)}function l(t){return t[this]}function h(t){return t[this]}var f=t("./util.js"),d=f.canEvaluate,p=f.isIdentifier;e.prototype.call=function(t){for(var e=arguments.length,n=new Array(e-1),i=1;e>i;++i)n[i-1]=arguments[i];if(d){var r=a(t);if(null!==r)return this._then(r,void 0,void 0,n,void 0)}return n.push(t),this._then(u,void 0,void 0,n,void 0)},e.prototype.get=function(t){var e,n="number"==typeof t;if(n)e=h;else if(d){var i=c(t);e=null!==i?i:l}else e=l;return this._then(e,void 0,void 0,t,void 0)}}},{"./util.js":38}],8:[function(t,e){"use strict";e.exports=function(e,n){var i=t("./errors.js"),r=i.canAttach,o=t("./async.js"),s=i.CancellationError;e.prototype._cancel=function(t){if(!this.isCancellable())return this;for(var e,n=this;void 0!==(e=n._cancellationParent)&&e.isCancellable();)n=e;this._unsetCancellable(),n._attachExtraTrace(t),n._rejectUnchecked(t)},e.prototype.cancel=function(t){return this.isCancellable()?(t=void 0!==t?r(t)?t:new Error(t+""):new s,o.invokeLater(this._cancel,this,t),this):this},e.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},e.prototype.uncancellable=function(){var t=new e(n);return t._propagateFrom(this,6),t._follow(this),t._unsetCancellable(),t},e.prototype.fork=function(t,e,n){var i=this._then(t,e,n,void 0,void 0);return i._setCancellable(),i._cancellationParent=void 0,i}}},{"./async.js":5,"./errors.js":13}],9:[function(t,e){"use strict";e.exports=function(){function e(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t.toString();var i=/\[object [a-zA-Z0-9$_]+\]/;if(i.test(e))try{var r=JSON.stringify(t);e=r}catch(o){}0===e.length&&(e="(empty array)")}return"(<"+n(e)+">, no stack trace)"}function n(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function i(t,e){this.captureStackTrace(i,e)}var r=t("./util.js").inherits,o=t("./es5.js").defineProperty,s=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),a=null,c=null;r(i,Error),i.prototype.captureStackTrace=function(t,e){u(this,t,e)},i.possiblyUnhandledRejection=function(t){if("object"==typeof console){var e;if("object"==typeof t||"function"==typeof t){var n=t.stack;e="Possibly unhandled "+c(n,t)}else e="Possibly unhandled "+String(t);"function"==typeof console.error||"object"==typeof console.error?console.error(e):("function"==typeof console.log||"object"==typeof console.log)&&console.log(e)}},i.combine=function(t,e){for(var n=t.length-1,i=t[n],r=-1,o=e.length-1;o>=0;--o)if(e[o]===i){r=o;break}for(var o=r;o>=0;--o){var c=e[o];if(t[n]!==c)break;t.pop(),n--}t.push("From previous event:");for(var u=t.concat(e),l=[],o=0,h=u.length;h>o;++o)s.test(u[o])&&a.test(u[o])||o>0&&!a.test(u[o])&&"From previous event:"!==u[o]||l.push(u[o]);return l},i.protectErrorMessageNewlines=function(t){for(var e=0;e<t.length&&!a.test(t[e]);++e);if(!(1>=e)){for(var n=[],i=0;e>i;++i)n.push(t.shift());t.unshift(n.join("\x00"))}},i.isSupported=function(){return"function"==typeof u};var u=function l(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){a=/^\s*at\s*/,c=function(t,n){return"string"==typeof t?t:void 0!==n.name&&void 0!==n.message?n.name+". "+n.message:e(n)};var t=Error.captureStackTrace;return function(e,n){t(e,n)}}var n=new Error;if("string"==typeof n.stack&&"function"==typeof"".startsWith&&n.stack.startsWith("stackDetection@")&&"stackDetection"===l.name){o(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),a=/@/;var i=/[@\n]/;return c=function(t,n){return"string"==typeof t?n.name+". "+n.message+"\n"+t:void 0!==n.name&&void 0!==n.message?n.name+". "+n.message:e(n)},function(t){for(var e=(new Error).stack,n=e.split(i),r=n.length,o="",s=0;r>s;s+=2)o+=n[s],o+="@",o+=n[s+1],o+="\n";t.stack=o}}return c=function(t,n){return"string"==typeof t?t:"object"!=typeof n&&"function"!=typeof n||void 0===n.name||void 0===n.message?e(n):n.name+". "+n.message},null}();return i}},{"./es5.js":15,"./util.js":38}],10:[function(t,e){"use strict";e.exports=function(e){function n(t,e,n){this._instances=t,this._callback=e,this._promise=n}function i(t,e){var n={},i=s(t,n,e);if(i===a)return i;var r=c(n);return r.length?(a.e=new u("Catch filter must inherit from Error or be a simple predicate function"),a):i}var r=t("./util.js"),o=t("./errors.js"),s=r.tryCatch1,a=r.errorObj,c=t("./es5.js").keys,u=o.TypeError;return n.prototype.doFilter=function(t){for(var n=this._callback,r=this._promise,c=r._boundTo,u=0,l=this._instances.length;l>u;++u){var h=this._instances[u],f=h===Error||null!=h&&h.prototype instanceof Error;if(f&&t instanceof h){var d=s(n,c,t);return d===a?(e.e=d.e,e):d}if("function"==typeof h&&!f){var p=i(h,t);if(p===a){var v=o.canAttach(a.e)?a.e:new Error(a.e+"");this._promise._attachExtraTrace(v),t=a.e;break}if(p){var d=s(n,c,t);return d===a?(e.e=d.e,e):d}}}return e.e=t,e},n}},{"./errors.js":13,"./es5.js":15,"./util.js":38}],11:[function(t,e){"use strict";var n=t("./util.js"),i=n.isPrimitive,r=n.wrapsPrimitiveReceiver;e.exports=function(t){var e=function(){return this},n=function(){throw this},o=function(t,e){return 1===e?function(){throw t}:2===e?function(){return t}:void 0};t.prototype["return"]=t.prototype.thenReturn=function(t){return r&&i(t)?this._then(o(t,2),void 0,void 0,void 0,void 0):this._then(e,void 0,void 0,t,void 0)},t.prototype["throw"]=t.prototype.thenThrow=function(t){return r&&i(t)?this._then(o(t,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,t,void 0)}}},{"./util.js":38}],12:[function(t,e){"use strict";e.exports=function(t,e){var n=t.reduce;t.prototype.each=function(t){return n(this,t,null,e)},t.each=function(t,i){return n(t,i,null,e)}}},{}],13:[function(t,e){"use strict";function n(t){try{d(t,"isOperational",!0)}catch(e){}}function i(t){return null==t?!1:t instanceof a||t.isOperational===!0}function r(t){return t instanceof Error}function o(t){return r(t)}function s(t,e){function n(i){return this instanceof n?(this.message="string"==typeof i?i:e,this.name=t,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new n(i)}return f(n,Error),n}function a(t){this.name="OperationalError",this.message=t,this.cause=t,this.isOperational=!0,t instanceof Error?(this.message=t.message,this.stack=t.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var c,u,l=t("./es5.js").freeze,h=t("./util.js"),f=h.inherits,d=h.notEnumerableProp,p=s("CancellationError","cancellation error"),v=s("TimeoutError","timeout error"),m=s("AggregateError","aggregate error");try{c=TypeError,u=RangeError}catch(_){c=s("TypeError","type error"),u=s("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<g.length;++y)"function"==typeof Array.prototype[g[y]]&&(m.prototype[g[y]]=Array.prototype[g[y]]);m.prototype.length=0,m.prototype.isOperational=!0;var b=0;m.prototype.toString=function(){var t=Array(4*b+1).join(" "),e="\n"+t+"AggregateError of:\n";b++,t=Array(4*b+1).join(" ");for(var n=0;n<this.length;++n){for(var i=this[n]===this?"[Circular AggregateError]":this[n]+"",r=i.split("\n"),o=0;o<r.length;++o)r[o]=t+r[o];i=r.join("\n"),e+=i+"\n"}return b--,e},f(a,Error);var w="__BluebirdErrorTypes__",j=Error[w];j||(j=l({CancellationError:p,TimeoutError:v,OperationalError:a,RejectionError:a,AggregateError:m}),d(Error,w,j)),e.exports={Error:Error,TypeError:c,RangeError:u,CancellationError:j.CancellationError,OperationalError:j.OperationalError,TimeoutError:j.TimeoutError,AggregateError:j.AggregateError,originatesFromRejection:i,markAsOriginatingFromRejection:n,canAttach:o}},{"./es5.js":15,"./util.js":38}],14:[function(t,e){"use strict";e.exports=function(e){function n(t){var n=new i(t),r=e.rejected(n),o=r._peekContext();return null!=o&&o._attachExtraTrace(n),r}var i=t("./errors.js").TypeError;return n}},{"./errors.js":13}],15:[function(t,e){var n=function(){"use strict";return void 0===this}();if(n)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n};else{var i={}.hasOwnProperty,r={}.toString,o={}.constructor.prototype,s=function(t){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e},a=function(t,e,n){return t[e]=n.value,t},c=function(t){return t},u=function(t){try{return Object(t).constructor.prototype}catch(e){return o}},l=function(t){try{return"[object Array]"===r.call(t)}catch(e){return!1}};e.exports={isArray:l,keys:s,defineProperty:a,freeze:c,getPrototypeOf:u,isES5:n}}},{}],16:[function(t,e){"use strict";e.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,i){return n(this,t,i,e)},t.filter=function(t,i,r){return n(t,i,r,e)}}},{}],17:[function(t,e){"use strict";e.exports=function(e,n,i){function r(){return this}function o(){throw this}function s(t){return function(){return t}}function a(t){return function(){throw t}}function c(t,e,n){var i;return i=f&&d(e)?n?s(e):a(e):n?r:o,t._then(i,p,void 0,e,void 0)}function u(t){var r=this.promise,o=this.handler,s=r._isBound()?o.call(r._boundTo):o();if(void 0!==s){var a=i(s,void 0);if(a instanceof e)return c(a,t,r.isFulfilled())}return r.isRejected()?(n.e=t,n):t}function l(t){var n=this.promise,r=this.handler,o=n._isBound()?r.call(n._boundTo,t):r(t);if(void 0!==o){var s=i(o,void 0);if(s instanceof e)return c(s,t,!0)}return t}var h=t("./util.js"),f=h.wrapsPrimitiveReceiver,d=h.isPrimitive,p=h.thrower;e.prototype._passThroughHandler=function(t,e){if("function"!=typeof t)return this.then();var n={promise:this,handler:t};return this._then(e?u:l,e?u:void 0,void 0,n,void 0)},e.prototype.lastly=e.prototype["finally"]=function(t){return this._passThroughHandler(t,!0)},e.prototype.tap=function(t){return this._passThroughHandler(t,!1)}}},{"./util.js":38}],18:[function(t,e){"use strict";e.exports=function(e,n,i,r){function o(t,n){for(var i=h,s=e,a=n.length,c=0;a>c;++c){var u=f(n[c],void 0,t);if(u===i)return s.reject(i.e);var l=r(u,o);if(l instanceof s)return l}return null}function s(t,n,r){var o=this._promise=new e(i);o._setTrace(void 0),this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(d):d}var a=t("./errors.js"),c=a.TypeError,u=t("./util.js").deprecated,l=t("./util.js"),h=l.errorObj,f=l.tryCatch1,d=[];s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},s.prototype._continue=function(t){if(t===h){this._generator=void 0;var n=a.canAttach(t.e)?t.e:new Error(t.e+"");return this._promise._attachExtraTrace(n),void this._promise._reject(t.e,n)}var i=t.value;if(t.done===!0)this._generator=void 0,this._promise._tryFollow(i)||this._promise._fulfill(i);else{var s=r(i,void 0);if(!(s instanceof e)&&(s=o(s,this._yieldHandlers),null===s))return void this._throw(new c("A value was yielded that could not be treated as a promise"));s._then(this._next,this._throw,void 0,this,null)}},s.prototype._throw=function(t){a.canAttach(t)&&this._promise._attachExtraTrace(t),this._continue(f(this._generator["throw"],this._generator,t))},s.prototype._next=function(t){this._continue(f(this._generator.next,this._generator,t))},e.coroutine=function(t,e){if("function"!=typeof t)throw new c("generatorFunction must be a function");var n=Object(e).yieldHandler,i=s;return function(){var e=t.apply(this,arguments),r=new i(void 0,void 0,n);return r._generator=e,r._next(void 0),r.promise()}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new c("fn must be a function");d.push(t)},e.spawn=function(t){if(u("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof t)return n("generatorFunction must be a function");var i=new s(t,this),r=i.promise();return i._run(e.spawn),r}}},{"./errors.js":13,"./util.js":38}],19:[function(t,e){"use strict";e.exports=function(e,n,i,r){function o(t){this._reject(t)}var s=t("./util.js"),a=s.canEvaluate,c=s.tryCatch1,u=s.errorObj;if(a){for(var l=function(t){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,t))},h=function(t){for(var e=[],n=1;t>=n;++n)e.push("holder.p"+n);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,e.join(", ")))},f=[],d=[void 0],p=1;5>=p;++p)f.push(l(p)),d.push(h(p));var v=function(t,e){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=e,this.total=t,this.now=0};v.prototype.callers=d,v.prototype.checkFulfillment=function(t){var e=this.now;
e++;var n=this.total;if(e>=n){var i=this.callers[n],r=c(i,void 0,this);r===u?t._rejectUnchecked(r.e):t._tryFollow(r)||t._fulfillUnchecked(r)}else this.now=e}}e.join=function(){var t,s=arguments.length-1;if(s>0&&"function"==typeof arguments[s]&&(t=arguments[s],6>s&&a)){var c=new e(r);c._setTrace(void 0);for(var u=new v(s,t),l=f,h=0;s>h;++h){var d=i(arguments[h],void 0);d instanceof e?d.isPending()?d._then(l[h],o,void 0,c,u):d.isFulfilled()?l[h].call(c,d._settledValue,u):(c._reject(d._settledValue),d._unsetRejectionIsUnhandled()):l[h].call(c,d,u)}return c}for(var p=arguments.length,m=new Array(p),_=0;p>_;++_)m[_]=arguments[_];var c=new n(m).promise();return void 0!==t?c.spread(t):c}}},{"./util.js":38}],20:[function(t,e){"use strict";e.exports=function(e,n,i,r,o){function s(t,e,n,i){this.constructor$(t),this._callback=e,this._preservedValues=i===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:f,this._init$(void 0,-2)}function a(t,e,n,i){var r="object"==typeof n&&null!==n?n.concurrency:0;return r="number"==typeof r&&isFinite(r)&&r>=1?r:0,new s(t,e,r,i)}var c=t("./util.js"),u=c.tryCatch3,l=c.errorObj,h={},f=[];c.inherits(s,n),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,n){var i=this._values;if(null!==i){var o=this.length(),s=this._preservedValues,a=this._limit;if(i[n]===h){if(i[n]=t,a>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(a>=1&&this._inFlight>=a)return i[n]=t,void this._queue.push(n);null!==s&&(s[n]=t);var c=this._callback,f=this._promise._boundTo,d=u(c,f,t,n,o);if(d===l)return this._reject(d.e);var p=r(d,void 0);if(p instanceof e){if(p.isPending())return a>=1&&this._inFlight++,i[n]=h,p._proxyPromiseArray(this,n);if(!p.isFulfilled())return p._unsetRejectionIsUnhandled(),this._reject(p.reason());d=p.value()}i[n]=d}var v=++this._totalResolved;v>=o&&(null!==s?this._filter(i,s):this._resolve(i))}},s.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){var i=t.pop();this._promiseFulfilled(n[i],i)}},s.prototype._filter=function(t,e){for(var n=e.length,i=new Array(n),r=0,o=0;n>o;++o)t[o]&&(i[r++]=e[o]);i.length=r,this._resolve(i)},s.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return"function"!=typeof t?i("fn must be a function"):a(this,t,e,null).promise()},e.map=function(t,e,n,r){return"function"!=typeof e?i("fn must be a function"):a(t,e,n,r).promise()}}},{"./util.js":38}],21:[function(t,e){"use strict";e.exports=function(e){function n(t){throw t}function i(t,e){if(!s.isArray(t))return r(t,e);var i=s.tryCatchApply(this,[null].concat(t),e);i===l&&a.invokeLater(n,void 0,i.e)}function r(t,e){var i=this,r=void 0===t?u(i,e,null):c(i,e,null,t);r===l&&a.invokeLater(n,void 0,r.e)}function o(t,e){var i=this,r=u(i,e,t);r===l&&a.invokeLater(n,void 0,r.e)}var s=t("./util.js"),a=t("./async.js"),c=s.tryCatch2,u=s.tryCatch1,l=s.errorObj;e.prototype.nodeify=function(t,e){if("function"==typeof t){var n=r;void 0!==e&&Object(e).spread&&(n=i),this._then(n,o,void 0,t,this._boundTo)}return this}}},{"./async.js":5,"./util.js":38}],22:[function(t,e){"use strict";e.exports=function(e,n){var i=t("./util.js"),r=t("./async.js"),o=t("./errors.js"),s=i.tryCatch1,a=i.errorObj;e.prototype.progressed=function(t){return this._then(void 0,void 0,t,void 0,void 0)},e.prototype._progress=function(t){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(t)},e.prototype._clearFirstHandlerData$Base=e.prototype._clearFirstHandlerData,e.prototype._clearFirstHandlerData=function(){this._clearFirstHandlerData$Base(),this._progressHandler0=void 0},e.prototype._progressHandlerAt=function(t){return 0===t?this._progressHandler0:this[(t<<2)+t-5+2]},e.prototype._doProgressWith=function(t){var n=t.value,i=t.handler,r=t.promise,c=t.receiver,u=s(i,c,n);if(u===a){if(null!=u.e&&"StopProgressPropagation"!==u.e.name){var l=o.canAttach(u.e)?u.e:new Error(u.e+"");r._attachExtraTrace(l),r._progress(u.e)}}else u instanceof e?u._then(r._progress,null,null,r,void 0):r._progress(u)},e.prototype._progressUnchecked=function(t){if(this.isPending())for(var i=this._length(),o=this._progress,s=0;i>s;s++){var a=this._progressHandlerAt(s),c=this._promiseAt(s);if(c instanceof e)"function"==typeof a?r.invoke(this._doProgressWith,this,{handler:a,promise:c,receiver:this._receiverAt(s),value:t}):r.invoke(o,c,t);else{var u=this._receiverAt(s);"function"==typeof a?a.call(u,t,c):u instanceof e&&u._isProxied()?u._progressUnchecked(t):u instanceof n&&u._promiseProgressed(t,c)}}}}},{"./async.js":5,"./errors.js":13,"./util.js":38}],23:[function(t,e){(function(n){"use strict";function i(t){try{Promise===t&&(Promise=r)}catch(e){}return t}var r;"undefined"!=typeof Promise&&(r=Promise),e.exports=function(){function e(t){if("function"!=typeof t)throw new x("the promise constructor requires a resolver function");if(this.constructor!==e)throw new x("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,t!==u&&this._resolveFromResolver(t)}function r(t){return t[0]}function o(){return new e.PromiseInspection(this)}var s=t("./util.js"),a=t("./async.js"),c=t("./errors.js"),u=function(){},l={},h={e:null},f=t("./thenables.js")(e,u),d=t("./promise_array.js")(e,u,f),p=t("./captured_trace.js")(),v=t("./catch_filter.js")(h),m=t("./promise_resolver.js"),_=s.isArray,g=s.errorObj,y=s.tryCatch1,b=s.tryCatch2,w=s.tryCatchApply,j=c.RangeError,x=c.TypeError,E=c.CancellationError,F=c.TimeoutError,k=c.OperationalError,C=c.originatesFromRejection,T=c.markAsOriginatingFromRejection,R=c.canAttach,A=s.thrower,S=t("./errors_api_rejection")(e),P=function(){return new x("circular promise resolution chain")};e.prototype.bind=function(t){var n=f(t,void 0),i=new e(u);if(n instanceof e){var o=n.then(function(t){i._setBoundTo(t)}),s=e.all([this,o]).then(r);i._follow(s)}else i._follow(this),i._setBoundTo(t);return i._propagateFrom(this,3),i},e.prototype.toString=function(){return"[object Promise]"},e.prototype.caught=e.prototype["catch"]=function(t){var n=arguments.length;if(n>1){var i,r=new Array(n-1),o=0;for(i=0;n-1>i;++i){var s=arguments[i];if("function"!=typeof s){var a=new x("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(a),e.reject(a)}r[o++]=s}r.length=o,t=arguments[i],this._resetTrace();var c=new v(r,t,this);return this._then(void 0,c.doFilter,void 0,c,void 0)}return this._then(void 0,t,void 0,void 0,void 0)},e.prototype.reflect=function(){return this._then(o,o,void 0,this,void 0)},e.prototype.then=function(t,e,n){return this._then(t,e,n,void 0,void 0)},e.prototype.done=function(t,e,n){var i=this._then(t,e,n,void 0,void 0);i._setIsFinal()},e.prototype.spread=function(t,e){return this._then(t,e,void 0,l,void 0)},e.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},e.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this._settledValue,t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this._settledValue,t.isRejected=!0),t},e.prototype.all=function(){return new d(this).promise()},e.is=function(t){return t instanceof e},e.all=function(t){return new d(t).promise()},e.prototype.error=function(t){return this.caught(C,t)},e.prototype._resolveFromSyncValue=function(t){if(t===g){this._cleanValues(),this._setRejected();var n=t.e;this._settledValue=n,this._tryAttachExtraTrace(n),this._ensurePossibleRejectionHandled()}else{var i=f(t,void 0);i instanceof e?this._follow(i):(this._cleanValues(),this._setFulfilled(),this._settledValue=t)}},e.method=function(t){if("function"!=typeof t)throw new x("fn must be a function");return function(){var n;switch(arguments.length){case 0:n=y(t,this,void 0);break;case 1:n=y(t,this,arguments[0]);break;case 2:n=b(t,this,arguments[0],arguments[1]);break;default:for(var i=arguments.length,r=new Array(i),o=0;i>o;++o)r[o]=arguments[o];n=w(t,r,this)}var s=new e(u);return s._setTrace(void 0),s._resolveFromSyncValue(n),s}},e.attempt=e["try"]=function(t,n,i){if("function"!=typeof t)return S("fn must be a function");var r=_(n)?w(t,n,i):y(t,i,n),o=new e(u);return o._setTrace(void 0),o._resolveFromSyncValue(r),o},e.defer=e.pending=function(){var t=new e(u);return t._setTrace(void 0),new m(t)},e.bind=function(t){var n=f(t,void 0),i=new e(u);if(i._setTrace(void 0),n instanceof e){var r=n.then(function(t){i._setBoundTo(t)});i._follow(r)}else i._setBoundTo(t),i._setFulfilled();return i},e.cast=function(t){var n=f(t,void 0);if(!(n instanceof e)){var i=n;n=new e(u),n._setTrace(void 0),n._setFulfilled(),n._cleanValues(),n._settledValue=i}return n},e.resolve=e.fulfilled=e.cast,e.reject=e.rejected=function(t){var n=new e(u);if(n._setTrace(void 0),T(t),n._cleanValues(),n._setRejected(),n._settledValue=t,!R(t)){var i=new Error(t+"");n._setCarriedStackTrace(i)}return n._ensurePossibleRejectionHandled(),n},e.onPossiblyUnhandledRejection=function(t){p.possiblyUnhandledRejection="function"==typeof t?t:void 0};var M;e.onUnhandledRejectionHandled=function(t){M="function"==typeof t?t:void 0};var O=!1||!("undefined"==typeof n||"string"!=typeof n.execPath||"object"!=typeof n.env||!n.env.BLUEBIRD_DEBUG&&"development"!==n.env.NODE_ENV);e.longStackTraces=function(){if(a.haveItemsQueued()&&O===!1)throw new Error("cannot enable long stack traces after promises have been created");O=p.isSupported()},e.hasLongStackTraces=function(){return O&&p.isSupported()},e.prototype._then=function(t,n,i,r,o){var s=void 0!==o,c=s?o:new e(u);if(!s){if(O){var l=this._peekContext()===this._traceParent;c._traceParent=l?this._traceParent:this}c._propagateFrom(this,7)}var h=this._addCallbacks(t,n,i,c,r);return this.isResolved()&&a.invoke(this._queueSettleAt,this,h),c},e.prototype._length=function(){return 262143&this._bitField},e.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},e.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},e.prototype._setLength=function(t){this._bitField=-262144&this._bitField|262143&t},e.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},e.prototype._setRejected=function(){this._bitField=134217728|this._bitField},e.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},e.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},e.prototype._isFinal=function(){return(33554432&this._bitField)>0},e.prototype._cancellable=function(){return(67108864&this._bitField)>0},e.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},e.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},e.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},e.prototype._setCarriedStackTrace=function(t){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=t},e.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},e.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},e.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},e.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[(t<<2)+t-5+4];return this._isBound()&&void 0===e?this._boundTo:e},e.prototype._promiseAt=function(t){return 0===t?this._promise0:this[(t<<2)+t-5+3]},e.prototype._fulfillmentHandlerAt=function(t){return 0===t?this._fulfillmentHandler0:this[(t<<2)+t-5+0]},e.prototype._rejectionHandlerAt=function(t){return 0===t?this._rejectionHandler0:this[(t<<2)+t-5+1]},e.prototype._addCallbacks=function(t,e,n,i,r){var o=this._length();if(o>=262138&&(o=0,this._setLength(0)),0===o)this._promise0=i,void 0!==r&&(this._receiver0=r),"function"!=typeof t||this._isCarryingStackTrace()||(this._fulfillmentHandler0=t),"function"==typeof e&&(this._rejectionHandler0=e),"function"==typeof n&&(this._progressHandler0=n);else{var s=(o<<2)+o-5;this[s+3]=i,this[s+4]=r,this[s+0]="function"==typeof t?t:void 0,this[s+1]="function"==typeof e?e:void 0,this[s+2]="function"==typeof n?n:void 0}return this._setLength(o+1),o},e.prototype._setProxyHandlers=function(t,e){var n=this._length();if(n>=262138&&(n=0,this._setLength(0)),0===n)this._promise0=e,this._receiver0=t;else{var i=(n<<2)+n-5;this[i+3]=e,this[i+4]=t,this[i+0]=this[i+1]=this[i+2]=void 0}this._setLength(n+1)},e.prototype._proxyPromiseArray=function(t,e){this._setProxyHandlers(t,e)},e.prototype._proxyPromise=function(t){t._setProxied(),this._setProxyHandlers(t,-15)},e.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=8388608|this._bitField,this._boundTo=t):this._bitField=-8388609&this._bitField},e.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},e.prototype._resolveFromResolver=function(t){function e(t){i._tryFollow(t)||i._fulfill(t)}function n(t){var e=R(t)?t:new Error(t+"");i._attachExtraTrace(e),T(t),i._reject(t,e===t?void 0:e)}var i=this;this._setTrace(void 0),this._pushContext();var r=b(t,void 0,e,n);if(this._popContext(),void 0!==r&&r===g){var o=r.e,s=R(o)?o:new Error(o+"");i._reject(o,s)}},e.prototype._spreadSlowCase=function(t,e,n,i){var r=new d(n).promise(),o=r._then(function(){return t.apply(i,arguments)},void 0,void 0,l,void 0);e._follow(o)},e.prototype._callSpread=function(t,n,i){var r=this._boundTo;if(_(i))for(var o=0,s=i.length;s>o;++o)if(f(i[o],void 0)instanceof e)return void this._spreadSlowCase(t,n,i,r);return n._pushContext(),w(t,i,r)},e.prototype._callHandler=function(t,e,n,i){var r;return e!==l||this.isRejected()?(n._pushContext(),r=y(t,e,i)):r=this._callSpread(t,n,i),n._popContext(),r},e.prototype._settlePromiseFromHandler=function(t,n,i,r){if(!(r instanceof e))return void t.call(n,i,r);if(!r.isResolved()){var o=this._callHandler(t,n,r,i);if(!r._isFollowing())if(o===g||o===r||o===h){var s=o===r?P():o.e,a=R(s)?s:new Error(s+"");o!==h&&r._attachExtraTrace(a),r._rejectUnchecked(s,a)}else{var c=f(o,r);if(c instanceof e){if(c.isRejected()&&!c._isCarryingStackTrace()&&!R(c._settledValue)){var a=new Error(c._settledValue+"");r._attachExtraTrace(a),c._setCarriedStackTrace(a)}r._follow(c),r._propagateFrom(c,1)}else r._fulfillUnchecked(o)}}},e.prototype._follow=function(t){this._setFollowing(),t.isPending()?(this._propagateFrom(t,1),t._proxyPromise(this)):t.isFulfilled()?this._fulfillUnchecked(t._settledValue):this._rejectUnchecked(t._settledValue,t._getCarriedStackTrace()),t._isRejectionUnhandled()&&t._unsetRejectionIsUnhandled(),O&&null==t._traceParent&&(t._traceParent=this)},e.prototype._tryFollow=function(t){if(this._isFollowingOrFulfilledOrRejected()||t===this)return!1;var n=f(t,void 0);return n instanceof e?(this._follow(n),!0):!1},e.prototype._resetTrace=function(){O&&(this._trace=new p(void 0===this._peekContext()))},e.prototype._setTrace=function(t){if(O){var e=this._peekContext();this._traceParent=e;var n=void 0===e;this._trace=void 0!==t&&t._traceParent===e?t._trace:new p(n)}return this},e.prototype._tryAttachExtraTrace=function(t){R(t)&&this._attachExtraTrace(t)},e.prototype._attachExtraTrace=function(t){if(O){var e=this,n=t.stack;n="string"==typeof n?n.split("\n"):[],p.protectErrorMessageNewlines(n);for(var i=1,r=1;null!=e&&null!=e._trace;)n=p.combine(n,e._trace.stack.split("\n")),e=e._traceParent,r++;var o=Error.stackTraceLimit||10,s=(o+i)*r,a=n.length;a>s&&(n.length=s),a>0&&(n[0]=n[0].split("\x00").join("\n")),t.stack=n.length<=i?"(No stack trace)":n.join("\n")}},e.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},e.prototype._propagateFrom=function(t,e){(1&e)>0&&t._cancellable()&&(this._setCancellable(),this._cancellationParent=t),(4&e)>0&&this._setBoundTo(t._boundTo),(2&e)>0&&this._setTrace(t)},e.prototype._fulfill=function(t){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(t)},e.prototype._reject=function(t,e){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(t,e)},e.prototype._settlePromiseAt=function(t){var n=this.isFulfilled()?this._fulfillmentHandlerAt(t):this._rejectionHandlerAt(t),i=this._settledValue,r=this._receiverAt(t),o=this._promiseAt(t);if("function"==typeof n)this._settlePromiseFromHandler(n,r,i,o);else{var s=!1,a=this.isFulfilled();void 0!==r&&(r instanceof e&&r._isProxied()?(r._unsetProxied(),a?r._fulfillUnchecked(i):r._rejectUnchecked(i,this._getCarriedStackTrace()),s=!0):r instanceof d&&(a?r._promiseFulfilled(i,o):r._promiseRejected(i,o),s=!0)),s||(a?o._fulfill(i):o._reject(i,this._getCarriedStackTrace()))}t>=4&&this._queueGC()},e.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},e.prototype._setProxied=function(){this._bitField=4194304|this._bitField},e.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},e.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},e.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},e.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},e.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),a.invokeLater(this._gc,this,void 0))},e.prototype._gc=function(){for(var t=5*this._length()-5,e=0;t>e;e++)delete this[e];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},e.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},e.prototype._queueSettleAt=function(t){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),a.invoke(this._settlePromiseAt,this,t)},e.prototype._fulfillUnchecked=function(t){if(this.isPending()){if(t===this){var e=P();return this._attachExtraTrace(e),this._rejectUnchecked(e,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=t;var n=this._length();n>0&&a.invoke(this._settlePromises,this,n)}},e.prototype._rejectUncheckedCheckError=function(t){var e=R(t)?t:new Error(t+"");this._rejectUnchecked(t,e===t?void 0:e)},e.prototype._rejectUnchecked=function(t,e){if(this.isPending()){if(t===this){var n=P();return this._attachExtraTrace(n),this._rejectUnchecked(n)}if(this._cleanValues(),this._setRejected(),this._settledValue=t,this._isFinal())return void a.invokeLater(A,void 0,void 0===e?t:e);var i=this._length();void 0!==e&&this._setCarriedStackTrace(e),i>0?a.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},e.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},e.prototype._settlePromises=function(){for(var t=this._length(),e=0;t>e;e++)this._settlePromiseAt(e)},e.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==p.possiblyUnhandledRejection&&a.invokeLater(this._notifyUnhandledRejection,this,void 0)},e.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof M&&a.invokeLater(M,void 0,this)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue,e=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==e&&(this._unsetCarriedStackTrace(),t=e),"function"==typeof p.possiblyUnhandledRejection&&p.possiblyUnhandledRejection(t,this)}};var I=[];return e.prototype._peekContext=function(){var t=I.length-1;return t>=0?I[t]:void 0},e.prototype._pushContext=function(){O&&I.push(this)},e.prototype._popContext=function(){O&&I.pop()},e.noConflict=function(){return i(e)},e.setScheduler=function(t){if("function"!=typeof t)throw new x("fn must be a function");a._schedule=t},p.isSupported()||(e.longStackTraces=function(){},O=!1),e._makeSelfResolutionError=P,t("./finally.js")(e,h,f),t("./direct_resolve.js")(e),t("./synchronous_inspection.js")(e),t("./join.js")(e,d,f,u),e.RangeError=j,e.CancellationError=E,e.TimeoutError=F,e.TypeError=x,e.OperationalError=k,e.RejectionError=k,e.AggregateError=c.AggregateError,s.toFastProperties(e),s.toFastProperties(e.prototype),e.Promise=e,t("./timers.js")(e,u,f),t("./race.js")(e,u,f),t("./call_get.js")(e),t("./generators.js")(e,S,u,f),t("./map.js")(e,d,S,f,u),t("./nodeify.js")(e),t("./promisify.js")(e,u),t("./props.js")(e,d,f),t("./reduce.js")(e,d,S,f,u),t("./settle.js")(e,d),t("./some.js")(e,d,S),t("./progress.js")(e,d),t("./cancel.js")(e,u),t("./filter.js")(e,u),t("./any.js")(e,d),t("./each.js")(e,u),t("./using.js")(e,S,f),e.prototype=e.prototype,e}}).call(this,t("_process"))},{"./any.js":4,"./async.js":5,"./call_get.js":7,"./cancel.js":8,"./captured_trace.js":9,"./catch_filter.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./errors_api_rejection":14,"./filter.js":16,"./finally.js":17,"./generators.js":18,"./join.js":19,"./map.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38,_process:39}],24:[function(t,e){"use strict";e.exports=function(e,n,i){function r(t){switch(t){case-1:return void 0;case-2:return[];case-3:return{}}}function o(t){var i=this._promise=new e(n),r=void 0;t instanceof e&&(r=t,i._propagateFrom(r,5)),i._setTrace(r),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var s=t("./errors.js").canAttach,a=t("./util.js"),c=a.isArray;return o.prototype.length=function(){return this._length},o.prototype.promise=function(){return this._promise},o.prototype._init=function u(t,n){var o=i(this._values,void 0);if(o instanceof e){if(this._values=o,o._setBoundTo(this._promise._boundTo),!o.isFulfilled())return o.isPending()?void o._then(u,this._reject,void 0,this,n):(o._unsetRejectionIsUnhandled(),void this._reject(o._settledValue));if(o=o._settledValue,!c(o)){var s=new e.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(s)}}else if(!c(o)){var s=new e.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(s)}if(0===o.length)return void(-5===n?this._resolveEmptyArray():this._resolve(r(n)));for(var a=this.getActualLength(o.length),l=a,h=this.shouldCopyValues()?new Array(a):this._values,f=!1,d=0;a>d;++d){var p=i(o[d],void 0);p instanceof e?p.isPending()?p._proxyPromiseArray(this,d):(p._unsetRejectionIsUnhandled(),f=!0):f=!0,h[d]=p}this._values=h,this._length=l,f&&this._scanDirectValues(a)},o.prototype._settlePromiseAt=function(t){var n=this._values[t];n instanceof e?n.isFulfilled()?this._promiseFulfilled(n._settledValue,t):n.isRejected()&&this._promiseRejected(n._settledValue,t):this._promiseFulfilled(n,t)},o.prototype._scanDirectValues=function(t){for(var e=0;t>e&&!this._isResolved();++e)this._settlePromiseAt(e)},o.prototype._isResolved=function(){return null===this._values},o.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},o.prototype.__hardReject__=o.prototype._reject=function(t){this._values=null;var e=s(t)?t:new Error(t+"");this._promise._attachExtraTrace(e),this._promise._reject(t,e)},o.prototype._promiseProgressed=function(t,e){this._isResolved()||this._promise._progress({index:e,value:t})},o.prototype._promiseFulfilled=function(t,e){if(!this._isResolved()){this._values[e]=t;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)}},o.prototype._promiseRejected=function(t){this._isResolved()||(this._totalResolved++,this._reject(t))},o.prototype.shouldCopyValues=function(){return!0},o.prototype.getActualLength=function(t){return t},o}},{"./errors.js":13,"./util.js":38}],25:[function(t,e){"use strict";function n(t){return t instanceof Error&&d.getPrototypeOf(t)===Error.prototype}function i(t){var e;return e=n(t)?new l(t):t,c.markAsOriginatingFromRejection(e),e}function r(t){function e(e,n){if(null!==t){if(e){var r=i(a(e));t._attachExtraTrace(r),t._reject(r)}else if(arguments.length>2){for(var o=arguments.length,s=new Array(o-1),c=1;o>c;++c)s[c-1]=arguments[c];t._fulfill(s)}else t._fulfill(n);t=null}}return e}var o,s=t("./util.js"),a=s.maybeWrapAsError,c=t("./errors.js"),u=c.TimeoutError,l=c.OperationalError,h=t("./async.js"),f=s.haveGetters,d=t("./es5.js");if(o=f?function(t){this.promise=t}:function(t){this.promise=t,this.asCallback=r(t),this.callback=this.asCallback},f){var p={get:function(){return r(this.promise)}};d.defineProperty(o.prototype,"asCallback",p),d.defineProperty(o.prototype,"callback",p)}o._nodebackForPromise=r,o.prototype.toString=function(){return"[object PromiseResolver]"},o.prototype.resolve=o.prototype.fulfill=function(t){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var e=this.promise;e._tryFollow(t)||h.invoke(e._fulfill,e,t)},o.prototype.reject=function(t){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var e=this.promise;c.markAsOriginatingFromRejection(t);var n=c.canAttach(t)?t:new Error(t+"");e._attachExtraTrace(n),h.invoke(e._reject,e,t),n!==t&&h.invoke(this._setCarriedStackTrace,this,n)},o.prototype.progress=function(t){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");h.invoke(this.promise._progress,this.promise,t)},o.prototype.cancel=function(){h.invoke(this.promise.cancel,this.promise,void 0)},o.prototype.timeout=function(){this.reject(new u("timeout"))},o.prototype.isResolved=function(){return this.promise.isResolved()},o.prototype.toJSON=function(){return this.promise.toJSON()},o.prototype._setCarriedStackTrace=function(t){this.promise.isRejected()&&this.promise._setCarriedStackTrace(t)},e.exports=o},{"./async.js":5,"./errors.js":13,"./es5.js":15,"./util.js":38}],26:[function(t,e){"use strict";e.exports=function(e,n){function i(t){return t.replace(/([$])/,"\\$")}function r(t){try{return t.__isPromisified__===!0}catch(e){return!1}}function o(t,e,n){var i=g.getDataPropertyOrDefault(t,e+n,k);return i?r(i):!1}function s(t,e,n){for(var i=0;i<t.length;i+=2){var r=t[i];if(n.test(r))for(var o=r.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new x("Cannot promisify an API that has normal methods with '"+e+"'-suffix")}}function a(t,e,n,i){for(var a=g.inheritedDataKeys(t),c=[],u=0;u<a.length;++u){var l=a[u],h=t[l];"function"!=typeof h||r(h)||o(t,l,e)||!i(l,h,t)||c.push(l,h)}return s(c,e,n),c}function c(t){for(var e=[t],n=Math.max(0,t-1-5),i=t-1;i>=n;--i)i!==t&&e.push(i);for(var i=t+1;5>=i;++i)e.push(i);return e}function u(t){return g.filledRange(t,"arguments[","]")}function l(t){return g.filledRange(t,"_arg","")}function h(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0}function f(t){return g.isIdentifier(t)?"."+t:"['"+t.replace(/(['\\])/g,"\\$1")+"']"}function d(t,i,r,o,s){function a(e){var n,r=u(e).join(", "),o=e>0?", ":"";return n="string"==typeof t?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",f(t)):i===_?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==i?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",n.replace("{{args}}",r).replace(", ",o)}function d(){for(var e="",n=0;n<v.length;++n)e+="case "+v[n]+":"+a(v[n]);var r;return r="string"==typeof t?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",f(t)):i===_?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",e+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",r)}var p=Math.max(0,h(o)-1),v=c(p),m="string"==typeof r&&g.isIdentifier(r)?r+s:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function FunctionName(Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(void 0);                                       \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",m).replace("Parameters",l(p)).replace("[CodeForSwitchCase]",d()))(e,t,i,b,w,y,n)
}function p(t,i){function r(){var r=i;i===_&&(r=this),"string"==typeof t&&(t=r[t]);var o=new e(n);o._setTrace(void 0);var s=y(o);try{t.apply(r,b(arguments,s))}catch(a){var c=w(a);o._attachExtraTrace(c),o._reject(c)}return o}return r.__isPromisified__=!0,r}function v(t,e,n,r){for(var o=new RegExp(i(e)+"$"),s=a(t,e,o,n),c=0,u=s.length;u>c;c+=2){var l=s[c],h=s[c+1],f=l+e;t[f]=r===C?C(l,_,l,h,e):r(h)}return g.toFastProperties(t),t}function m(t,e){return C(t,e,void 0,t)}var _={},g=t("./util.js"),y=t("./promise_resolver.js")._nodebackForPromise,b=g.withAppended,w=g.maybeWrapAsError,j=g.canEvaluate,x=t("./errors").TypeError,E="Async",F=function(t,e){return g.isIdentifier(t)&&"_"!==t.charAt(0)&&!g.isClass(e)},k={__isPromisified__:!0},C=j?d:p;e.promisify=function(t,e){if("function"!=typeof t)throw new x("fn must be a function");return r(t)?t:m(t,arguments.length<2?_:e)},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new x("the target of promisifyAll must be an object or a function");e=Object(e);var n=e.suffix;"string"!=typeof n&&(n=E);var i=e.filter;"function"!=typeof i&&(i=F);var r=e.promisifier;if("function"!=typeof r&&(r=C),!g.isIdentifier(n))throw new RangeError("suffix must be a valid identifier");for(var o=g.inheritedDataKeys(t,{includeHidden:!0}),s=0;s<o.length;++s){var a=t[o[s]];"constructor"!==o[s]&&g.isClass(a)&&(v(a.prototype,n,i,r),v(a,n,i,r))}return v(t,n,i,r)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(t,e){"use strict";e.exports=function(e,n,i){function r(t){for(var e=u.keys(t),n=e.length,i=new Array(2*n),r=0;n>r;++r){var o=e[r];i[r]=t[o],i[r+n]=o}this.constructor$(i)}function o(t){var n,o=i(t,void 0);return c(o)?(n=o instanceof e?o._then(e.props,void 0,void 0,void 0,void 0):new r(o).promise(),o instanceof e&&n._propagateFrom(o,4),n):a("cannot await properties of a non-object")}var s=t("./util.js"),a=t("./errors_api_rejection")(e),c=s.isObject,u=t("./es5.js");s.inherits(r,n),r.prototype._init=function(){this._init$(void 0,-3)},r.prototype._promiseFulfilled=function(t,e){if(!this._isResolved()){this._values[e]=t;var n=++this._totalResolved;if(n>=this._length){for(var i={},r=this.length(),o=0,s=this.length();s>o;++o)i[this._values[o+r]]=this._values[o];this._resolve(i)}}},r.prototype._promiseProgressed=function(t,e){this._isResolved()||this._promise._progress({key:this._values[e+this.length()],value:t})},r.prototype.shouldCopyValues=function(){return!1},r.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return o(this)},e.props=function(t){return o(t)}}},{"./errors_api_rejection":14,"./es5.js":15,"./util.js":38}],28:[function(t,e){"use strict";function n(t,e,n,i,r){for(var o=0;r>o;++o)n[o+i]=t[o+e]}function i(t){this._capacity=t,this._length=0,this._front=0,this._makeCapacity()}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var n=this._front+e&this._capacity-1;this[n]=t,this._length=e+1},i.prototype.push=function(t,e,n){var i=this.length()+3;if(this._willBeOverCapacity(i))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var r=this._front+i-3;this._checkCapacity(i);var o=this._capacity-1;this[r+0&o]=t,this[r+1&o]=e,this[r+2&o]=n,this._length=i},i.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},i.prototype.length=function(){return this._length},i.prototype._makeCapacity=function(){for(var t=this._capacity,e=0;t>e;++e)this[e]=void 0},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<3)},i.prototype._resizeTo=function(t){var e=this._front,i=this._capacity,r=new Array(i),o=this.length();if(n(this,0,r,0,i),this._capacity=t,this._makeCapacity(),this._front=0,i>=e+o)n(r,e,this,0,o);else{var s=o-(e+o&i-1);n(r,e,this,0,s),n(r,0,this,s,o-s)}},e.exports=i},{}],29:[function(t,e){"use strict";e.exports=function(e,n,i){function r(t,r){var u=i(t,void 0);if(u instanceof e)return a(u);if(!s(t))return o("expecting an array, a promise or a thenable");var l=new e(n);void 0!==r?l._propagateFrom(r,7):l._setTrace(void 0);for(var h=l._fulfill,f=l._reject,d=0,p=t.length;p>d;++d){var v=t[d];(void 0!==v||c.call(t,d))&&e.cast(v)._then(h,f,void 0,l,null)}return l}var o=t("./errors_api_rejection.js")(e),s=t("./util.js").isArray,a=function(t){return t.then(function(e){return r(e,t)})},c={}.hasOwnProperty;e.race=function(t){return r(t,void 0)},e.prototype.race=function(){return r(this,void 0)}}},{"./errors_api_rejection.js":14,"./util.js":38}],30:[function(t,e){"use strict";e.exports=function(e,n,i,r,o){function s(t,n,i,s){this.constructor$(t),this._preservedValues=s===o?[]:null,this._zerothIsAccum=void 0===i,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var a=r(i,void 0),c=!1,u=a instanceof e;u&&(a.isPending()?a._proxyPromiseArray(this,-1):a.isFulfilled()?(i=a.value(),this._gotAccum=!0):(a._unsetRejectionIsUnhandled(),this._reject(a.reason()),c=!0)),u||this._zerothIsAccum||(this._gotAccum=!0),this._callback=n,this._accum=i,c||this._init$(void 0,-5)}function a(t,e,n,r){if("function"!=typeof e)return i("fn must be a function");var o=new s(t,e,n,r);return o.promise()}var c=t("./util.js"),u=c.tryCatch4,l=c.tryCatch3,h=c.errorObj;c.inherits(s,n),s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},s.prototype._promiseFulfilled=function(t,n){var i=this._values;if(null!==i){var o,s=this.length(),a=this._preservedValues,c=null!==a,f=this._gotAccum,d=this._valuesPhase;if(!d)for(d=this._valuesPhase=Array(s),o=0;s>o;++o)d[o]=0;if(o=d[n],0===n&&this._zerothIsAccum?(f||(this._accum=t,this._gotAccum=f=!0),d[n]=0===o?1:2):-1===n?f||(this._accum=t,this._gotAccum=f=!0):0===o?d[n]=1:(d[n]=2,f&&(this._accum=t)),f){for(var p,v=this._callback,m=this._promise._boundTo,_=this._reducingIndex;s>_;++_)if(o=d[_],2!==o){if(1!==o)return;if(t=i[_],t instanceof e){if(!t.isFulfilled())return t.isPending()?void 0:(t._unsetRejectionIsUnhandled(),this._reject(t.reason()));t=t._settledValue}if(c?(a.push(t),p=l(v,m,t,_,s)):p=u(v,m,this._accum,t,_,s),p===h)return this._reject(p.e);var g=r(p,void 0);if(g instanceof e){if(g.isPending())return d[_]=4,g._proxyPromiseArray(this,_);if(!g.isFulfilled())return g._unsetRejectionIsUnhandled(),this._reject(g.reason());p=g.value()}this._reducingIndex=_+1,this._accum=p}else this._reducingIndex=_+1;this._reducingIndex<s||this._resolve(c?a:this._accum)}}},e.prototype.reduce=function(t,e){return a(this,t,e,null)},e.reduce=function(t,e,n,i){return a(t,e,n,i)}}},{"./util.js":38}],31:[function(t,e){(function(t){"use strict";var n,i;if("object"==typeof t&&"string"==typeof t.version)n=function(e){t.nextTick(e)};else if("undefined"!=typeof MutationObserver&&(i=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(i=WebKitMutationObserver))n=function(){var t=document.createElement("div"),e=void 0,n=new i(function(){var t=e;e=void 0,t()});return n.observe(t,{attributes:!0}),function(n){e=n,t.classList.toggle("foo")}}();else{if("undefined"==typeof setTimeout)throw new Error("no async scheduler available");n=function(t){setTimeout(t,0)}}e.exports=n}).call(this,t("_process"))},{_process:39}],32:[function(t,e){"use strict";e.exports=function(e,n){function i(t){this.constructor$(t)}var r=e.PromiseInspection,o=t("./util.js");o.inherits(i,n),i.prototype._promiseResolved=function(t,e){this._values[t]=e;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)},i.prototype._promiseFulfilled=function(t,e){if(!this._isResolved()){var n=new r;n._bitField=268435456,n._settledValue=t,this._promiseResolved(e,n)}},i.prototype._promiseRejected=function(t,e){if(!this._isResolved()){var n=new r;n._bitField=134217728,n._settledValue=t,this._promiseResolved(e,n)}},e.settle=function(t){return new i(t).promise()},e.prototype.settle=function(){return new i(this).promise()}}},{"./util.js":38}],33:[function(t,e){"use strict";e.exports=function(e,n,i){function r(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||0>e)return i("expecting a positive integer");var n=new r(t),o=n.promise();return o.isRejected()?o:(n.setHowMany(e),n.init(),o)}var s=t("./util.js"),a=t("./errors.js").RangeError,c=t("./errors.js").AggregateError,u=s.isArray;s.inherits(r,n),r.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=u(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},r.prototype.init=function(){this._initialized=!0,this._init()},r.prototype.setUnwrap=function(){this._unwrap=!0},r.prototype.howMany=function(){return this._howMany},r.prototype.setHowMany=function(t){this._isResolved()||(this._howMany=t)},r.prototype._promiseFulfilled=function(t){this._isResolved()||(this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values)))},r.prototype._promiseRejected=function(t){if(!this._isResolved()&&(this._addRejected(t),this.howMany()>this._canPossiblyFulfill())){for(var e=new c,n=this.length();n<this._values.length;++n)e.push(this._values[n]);this._reject(e)}},r.prototype._fulfilled=function(){return this._totalResolved},r.prototype._rejected=function(){return this._values.length-this.length()},r.prototype._addRejected=function(t){this._values.push(t)},r.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},r.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},r.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},r.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return o(t,e)},e.prototype.some=function(t){return o(this,t)},e._SomePromiseArray=r}},{"./errors.js":13,"./util.js":38}],34:[function(t,e){"use strict";e.exports=function(t){function e(t){void 0!==t?(this._bitField=t._bitField,this._settledValue=t.isResolved()?t._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}e.prototype.isFulfilled=t.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},e.prototype.isRejected=t.prototype.isRejected=function(){return(134217728&this._bitField)>0},e.prototype.isPending=t.prototype.isPending=function(){return 0===(402653184&this._bitField)},e.prototype.value=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},e.prototype.error=e.prototype.reason=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},e.prototype.isResolved=t.prototype.isResolved=function(){return(402653184&this._bitField)>0},t.PromiseInspection=e}},{}],35:[function(t,e){"use strict";e.exports=function(e,n){function i(t){try{return t.then}catch(e){return u.e=e,u}}function r(t,r){if(l(t)){if(t instanceof e)return t;if(o(t)){var a=new e(n);return a._setTrace(void 0),t._then(a._fulfillUnchecked,a._rejectUncheckedCheckError,a._progressUnchecked,a,null),a._setFollowing(),a}var h=i(t);if(h===u)return void 0!==r&&c(h.e)&&r._attachExtraTrace(h.e),e.reject(h.e);if("function"==typeof h)return s(t,h,r)}return t}function o(t){return h.call(t,"_promise0")}function s(t,n,i){function r(n){if(!u){if(u=!0,t===n){var r=e._makeSelfResolutionError();return void 0!==i&&i._attachExtraTrace(r),void a.promise._reject(r,void 0)}a.resolve(n)}}function o(t){if(!u){u=!0;var e=c(t)?t:new Error(t+"");void 0!==i&&i._attachExtraTrace(e),a.promise._reject(t,e)}}function s(t){if(!u){var e=a.promise;"function"==typeof e._progress&&e._progress(t)}}var a=e.defer(),u=!1;try{n.call(t,r,o,s)}catch(l){if(!u){u=!0;var h=c(l)?l:new Error(l+"");void 0!==i&&i._attachExtraTrace(h),a.promise._reject(l,h)}}return a.promise}var a=t("./util.js"),c=t("./errors.js").canAttach,u=a.errorObj,l=a.isObject,h={}.hasOwnProperty;return r}},{"./errors.js":13,"./util.js":38}],36:[function(t,e){"use strict";var n=function(t,e){var n=arguments.length,i=arguments[2],r=arguments[3],o=n>=5?arguments[4]:void 0;return setTimeout(function(){t(i,r,o)},0|e)};e.exports=function(e,i,r){function o(t){var e=this;return e instanceof Number&&(e=+e),clearTimeout(e),t}function s(t){var e=this;throw e instanceof Number&&(e=+e),clearTimeout(e),t}var a=(t("./util.js"),t("./errors.js")),c=(t("./errors_api_rejection")(e),e.TimeoutError),u=function(t,e,n){if(t.isPending()){"string"!=typeof e&&(e="operation timed out after "+n+" ms");var i=new c(e);a.markAsOriginatingFromRejection(i),t._attachExtraTrace(i),t._cancel(i)}},l=function(t,e){e._fulfill(t)},h=e.delay=function(t,o){void 0===o&&(o=t,t=void 0),o=+o;var s=r(t,void 0),a=new e(i);return s instanceof e?(a._propagateFrom(s,7),a._follow(s),a.then(function(t){return e.delay(t,o)})):(a._setTrace(void 0),n(l,o,t,a),a)};e.prototype.delay=function(t){return h(this,t)},e.prototype.timeout=function(t,r){t=+t;var a=new e(i);a._propagateFrom(this,7),a._follow(this);var c=n(u,t,a,r,t);return a.cancellable()._then(o,s,void 0,c,void 0)}}},{"./errors.js":13,"./errors_api_rejection":14,"./util.js":38}],37:[function(t,e){"use strict";e.exports=function(e,n,i){function r(t){for(var n=t.length,i=0;n>i;++i){var r=t[i];if(r.isRejected())return e.reject(r.error());t[i]=r.value()}return t}function o(t){setTimeout(function(){throw t},0)}function s(t){var e=i(t,void 0);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function a(t,n){function r(){if(a>=c)return u.resolve();var l=s(t[a++]);if(l instanceof e&&l._isDisposable()){try{l=i(l._getDisposer().tryDispose(n),void 0)}catch(h){return o(h)}if(l instanceof e)return l._then(r,o,null,null,null)}r()}var a=0,c=t.length,u=e.defer();return r(),u.promise}function c(t){var e=new p;return e._settledValue=t,e._bitField=268435456,a(this,e).thenReturn(t)}function u(t){var e=new p;return e._settledValue=t,e._bitField=134217728,a(this,e).thenThrow(t)}function l(t,e){this._data=t,this._promise=e}function h(t,e){this.constructor$(t,e)}var f=t("./errors.js").TypeError,d=t("./util.js").inherits,p=e.PromiseInspection;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(t){var e=this.resource(),n=null!==e?this.doDispose(e,t):null;return this._promise._unsetDisposable(),this._data=this._promise=null,n},l.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},d(h,l),h.prototype.doDispose=function(t,e){var n=this.data();return n.call(t,t,e)},e.using=function(){var t=arguments.length;if(2>t)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[t-1];if("function"!=typeof i)return n("fn must be a function");t--;for(var o=new Array(t),s=0;t>s;++s){var a=arguments[s];if(l.isDisposer(a)){var h=a;a=a.promise(),a._setDisposable(h)}o[s]=a}return e.settle(o).then(r).spread(i)._then(c,u,void 0,o,void 0)},e.prototype._setDisposable=function(t){this._bitField=262144|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(262144&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new h(t,this);throw new f}}},{"./errors.js":13,"./util.js":38}],38:[function(t,e,n){"use strict";function i(t,e,n){try{return t.call(e,n)}catch(i){return x.e=i,x}}function r(t,e,n,i){try{return t.call(e,n,i)}catch(r){return x.e=r,x}}function o(t,e,n,i,r){try{return t.call(e,n,i,r)}catch(o){return x.e=o,x}}function s(t,e,n,i,r,o){try{return t.call(e,n,i,r,o)}catch(s){return x.e=s,x}}function a(t,e,n){try{return t.apply(n,e)}catch(i){return x.e=i,x}}function c(t){return"string"==typeof t?t:""+t}function u(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function l(t){return!u(t)}function h(t){return u(t)?new Error(c(t)):t}function f(t,e){var n,i=t.length,r=new Array(i+1);for(n=0;i>n;++n)r[n]=t[n];return r[n]=e,r}function d(t,e,n){if(!b.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var i=Object.getOwnPropertyDescriptor(t,e);return null!=i?null==i.get&&null==i.set?i.value:n:void 0}function p(t,e,n){if(u(t))return t;var i={value:n,configurable:!0,enumerable:!1,writable:!0};return b.defineProperty(t,e,i),t}function v(t){throw t}function m(t){try{if("function"==typeof t){var e=b.keys(t.prototype);return e.length>0&&!(1===e.length&&"constructor"===e[0])}return!1}catch(n){return!1}}function _(t){function e(){}return e.prototype=t,e}function g(t){return C.test(t)}function y(t,e,n){for(var i=new Array(t),r=0;t>r;++r)i[r]=e+r+n;return i}var b=t("./es5.js"),w=function(){try{var t={};return b.defineProperty(t,"f",{get:function(){return 3}}),3===t.f}catch(e){return!1}}(),j="undefined"==typeof navigator,x={e:{}},E=function(t,e){function n(){this.constructor=t,this.constructor$=e;for(var n in e.prototype)i.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}var i={}.hasOwnProperty;return n.prototype=e.prototype,t.prototype=new n,t.prototype},F=function(){return"string"!==this}.call("string"),k=function(){return b.isES5?function(t,e){for(var n=[],i=Object.create(null),r=Object(e).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=t;){var o;try{o=r(t)}catch(s){return n}for(var a=0;a<o.length;++a){var c=o[a];if(!i[c]){i[c]=!0;var u=Object.getOwnPropertyDescriptor(t,c);null!=u&&null==u.get&&null==u.set&&n.push(c)}}t=b.getPrototypeOf(t)}return n}:function(t){var e=[];for(var n in t)e.push(n);return e}}(),C=/^[a-z$_][a-z$_0-9]*$/i,T={isClass:m,isIdentifier:g,inheritedDataKeys:k,getDataPropertyOrDefault:d,thrower:v,isArray:b.isArray,haveGetters:w,notEnumerableProp:p,isPrimitive:u,isObject:l,canEvaluate:j,errorObj:x,tryCatch1:i,tryCatch2:r,tryCatch3:o,tryCatch4:s,tryCatchApply:a,inherits:E,withAppended:f,asString:c,maybeWrapAsError:h,wrapsPrimitiveReceiver:F,toFastProperties:_,filledRange:y};e.exports=T},{"./es5.js":15}],39:[function(t,e){function n(){}var i=e.exports={};i.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.MutationObserver,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};var i=[];if(e){var r=document.createElement("div"),o=new MutationObserver(function(){var t=i.slice();i.length=0,t.forEach(function(t){t()})});return o.observe(r,{attributes:!0}),function(t){i.length||r.setAttribute("yes","no"),i.push(t)}}return n?(window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}):function(t){setTimeout(t,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],40:[function(t,e){function n(t){for(var e,n,i,r,o,s="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=new Uint8Array(t),u=c.byteLength,l=u%3,h=u-l,f=0;h>f;f+=3)o=c[f]<<16|c[f+1]<<8|c[f+2],e=(16515072&o)>>18,n=(258048&o)>>12,i=(4032&o)>>6,r=63&o,s+=a[e]+a[n]+a[i]+a[r];return 1==l?(o=c[h],e=(252&o)>>2,n=(3&o)<<4,s+=a[e]+a[n]+"=="):2==l&&(o=c[h]<<8|c[h+1],e=(64512&o)>>10,n=(1008&o)>>4,i=(15&o)<<2,s+=a[e]+a[n]+a[i]+"="),s}var i=function(t,e,i){var r,o=!1,s={uri:function(){return t},source:t};if(!e||!i)return s;var a=/\.(\w+)$/.exec(t)[1];r="data:image/"+a+";base64,"+n(e),s.uri=function(){return r},o=!0,i(s)};e.exports=i},{}],41:[function(t,e){function n(){return i=h.filter(function(t){return p.test(t)}),r=h.filter(function(t){return d.test(t)}),i.forEach(function(t){t in f||(f[t]=u(t))}),r.forEach(function(t){t in f||(f[t]=c(t))}),v}var i,r,o,s,a=t("./loader"),c=t("./image"),u=t("./sound"),l=t("bluebird"),h=[],f={},d=/\.(gif|jpeg|jpg|png)$/,p=/\.(mp3|mp4|ogg)$/,v={};v.add=function(t){return"string"==typeof t?h.push(t):h=h.concat(t),n()},v.preload=function(){return n(),o=new a(r,c),s=new a(i,u),l.all([s.load(),o.load()]).then(function(t){var e=t[0],n=t[1];e.forEach(function(t){f[t.source]=t}),n.forEach(function(t){f[t.source]=t})})},v.get=function(t){return n(),t in f?f[t]:void 0},e.exports=v},{"./image":40,"./loader":42,"./sound":44,bluebird:6}],42:[function(t,e){var n=t("bluebird"),i=function(t,e){this.files=t,this.transform=e||function(t,e,n){return n(e)}};i.prototype.loadBuffer=function(t){var e=this;return new n(function(n,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){e.transform(t,r.response,function(t){n(t)})},r.onerror=i,r.send()})},i.prototype.load=function(){var t=this,e=t.files.map(function(e){return t.loadBuffer(e)});return n.all(e)},e.exports=i},{bluebird:6}],43:[function(t,e){e.exports=window.AudioContext||window.webAudioContext||window.webkitAudioContext},{}],44:[function(t,e){function n(t,e,n){var i,o=!1,s={play:function(){if(o){var t=r.createBufferSource();t.buffer=i,t.onended=function(){t=null},t.connect(r.destination),t.start(0)}},source:t};return e&&n?void r.decodeAudioData(e,function(t){i=t,o=!0,n(s)}):s}var i=t("./context"),r=new i;e.exports=n},{"./context":43}],45:[function(t,e){var n=t("../utilities"),i=t("interpol"),r=t("../config"),o=t("../assetmanager"),s={x:0,y:0,sx:0,sy:0,vx:0,vy:0,radius:10,color:"#ffffff"};s.init=function(t,e,n,i,r,o){this.x=t||this.x,this.y=e||this.y,this.sx=t||this.x,this.sy=e||this.y,this.vx=n||this.vx,this.vy=i||this.vy,this.radius=r||this.radius,this.color=o||this.color},s.update=function(t,e,n,i){this.x+=this.vx+(n||0),this.y+=this.vy+(i||0),(this.x<-this.radius||this.x-this.radius>t||this.y<-this.radius||this.y-this.radius>e)&&(this.x=this.sx,this.y=this.sy)};var a={particles:[]};a.init=function(t,e,i){this.particles=[];for(var r=0;t>r;r++){var o=Object.create(s);o.init(e,i,n.floatRange(-1,1),n.floatRange(-1,1),n.floatRange(15,30),"rgba("+n.range(0,255)+","+n.range(0,255)+","+n.range(0,255)+","+n.floatRange(.1,.7)+")"),this.particles.push(o)}};var c={target:void 0,canvas:void 0,context:void 0,system:void 0};c.init=function(t){var e=this;e.target=t,e.canvas=document.createElement("canvas");var o=function s(){return e.canvas.width=n.windowWidth(),e.canvas.height=n.windowHeight(),s}();e.system=Object.create(a),e.system.init(250,e.canvas.width/2,e.canvas.height/2),window.addEventListener("resize",o),e.target.appendChild(e.canvas),e.context=e.canvas.getContext("2d"),r.global.useBackgroundAnimation&&i.pipeline.add("background",e.render.bind(e)),n.emitter.on("global_config_change",function(t,n){"useBackgroundAnimation"===t&&(n&&!i.pipeline.has("background")?i.pipeline.add("background",e.render.bind(e)):i.pipeline.has("background")&&(i.pipeline.remove("background"),e.context.clearRect(0,0,e.canvas.width,e.canvas.height)))})},c.render=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var t=new Image;t.src=o.get("assets/img/playlogo-sml.png").uri();for(var e=0;e<this.system.particles.length;e++){var n=this.system.particles[e];n.update(this.canvas.width,this.canvas.height),this.context.drawImage(t,n.x,n.y,n.radius,n.radius)}},c.remove=function(){this.target.removeChild(this.canvas),i.pipeline.remove("background")},e.exports=c},{"../assetmanager":41,"../config":46,"../utilities":59,interpol:2}],46:[function(t,e){var n=t("./utilities"),i={};["displayMetrics","useSound","useAccelerometer","useGamification","useDynamicLighting","useBackgroundAnimation","useMessaging","isCeltra"].forEach(function(t){var e=!1;Object.defineProperty(i,t,{enumerable:!0,set:function(i){e=i,n.emitter.emit("global_config_change",t,e)},get:function(){return e}})}),i.displayMetrics=!1,i.useSound=!0,i.useGamification=!0,i.useAccelerometer=!0,i.useDynamicLighting=!0;var r={castShadow:!0,useInertia:!1,useBackgrounds:!0,useContent:!1,useVideo:!1,useGif:!1,cropLargeFaces:!1,isSequential:!1,normaliseFacialRotation:!0},o={displayMetrics:"Display Metrics",useSound:"Sound",useMessaging:"Post Messaging",useGamification:"Gamification",useDynamicLighting:"Dynamic Lighting",useBackgroundAnimation:"Background Animation",useInertia:"Inertial Interaction",useAccelerometer:"Accelerometer",useBackgrounds:"Face Backgrounds",useContent:"Face Content",useVideo:"Video Face Content",useGif:"GIF Face Content",cropLargeFaces:"Crop Full Face Assets",isSequential:"Sequential Interaction",normaliseFacialRotation:"Normalise Face Rotation",isCeltra:"Celtra Platform",castShadow:"Cast Shadow"},s={displayMetrics:"Display fps (frames per second) and frame time (in milliseconds).",useSound:"Have sounds throughout the Ad.",useMessaging:"For interaction with Ad Server APIs as an Iframe.",useGamification:'Puzzle comprised of four cubes, match the sides to "win".',useDynamicLighting:"Dynamically light the cubes with a forward facing light.",useBackgroundAnimation:"Turn on a simple background animation for performance testing.",useInertia:'Allow the user to "flick" the cube and it to gradually halt movement.',useAccelerometer:"Turn on rotation from Accelerometer/Gyro data.",useBackgrounds:"Show backgrounds on the cube faces.",useContent:"Show content on the cube faces.",useVideo:"Show a video on one face of the cube.",useGif:"Show a GIF on one face of the cube.",cropLargeFaces:"Use the full face assets on the gamified cube to reduce ad weight.",isSequential:"Always display the next face of the cube no matter which way it turns.",normaliseFacialRotation:"Always display cube faces at the correct orientation.",isCeltra:"Will be green if we are in Celtra.",castShadow:"Cast a shadow underneath the cube."};e.exports={global:i,cube:r,titles:o,descriptions:s}},{"./utilities":59}],47:[function(t,e){var n=t("../utilities"),i={init:function(t,e,n,i,r){this.id=Math.random().toString(36).substr(5,10),this.width=t,this.height=e,this.index=n,this.name=i,this.target=r,this.rotation={X:0,Y:0,Z:0},this.translate={X:0,Y:0,Z:0},this.element=this.getElement(),this.target.appendChild(this.element)},getElement:function(){return n.getElement("div","common",{},{})},render:function(){this.element.style[n.CSS_TRANSFORM]="rotateX("+this.rotation.X+"deg) rotateY("+this.rotation.Y+"deg) rotateZ("+this.rotation.Z+"deg) translateX("+this.translate.X+"px) translateY("+this.translate.Y+"px) translateZ("+this.translate.Z+"px)"},remove:function(){this.element.parentNode.removeChild(this.element)}};e.exports=i},{"../utilities":59}],48:[function(t,e){var n=t("../../utilities"),i=t("../../config"),r=t("../../messaging"),o={background:"assets/img/cubes/{name}/side{i}.jpg",sides:[{html:function(t){return(t.useGif?'<img class="gif" src="assets/img/tes.gif" width="100%" height="100%" /></span><span>':"")+"<p>Side 1.</p><button>Link out</button>"},onload:function(t,e){n("button",t).forEach(function(o){o.addEventListener("click",function(){i.global.useMessaging&&r.post("btn_interaction")}),e.useGif&&n(".gif",t).forEach(function(t){t.addEventListener("touchmove",n.prevent)})})}},{html:function(t){return t.useVideo?'<h1>Video</h1><div class="vid"><video src="assets/video/test.mp4" width="100%" height="100%" style="display: none;"></video></div>':"<p>Side 2.</p><button>Click me</button>"},onload:function(t,e){n("button",t).forEach(function(t){t.addEventListener("click",function(){i.global.useMessaging&&r.post("btn_interaction")})}),e.useVideo&&n(".vid",t).forEach(function(t){t.addEventListener("click",function(){var e=n("video",t)[0];e.style.display="block",e.play()})})}},{html:function(){return"<p>Side 3.</p><button>Click me</button>"},onload:function(t){n("button",t).forEach(function(t){t.addEventListener("click",function(){i.global.useMessaging&&r.post("btn_interaction")})})}},{html:function(){return"<p>Side 4.</p><button>Click me</button>"},onload:function(t){n("button",t).forEach(function(t){t.addEventListener("click",function(){i.global.useMessaging&&r.post("btn_interaction")})})}},{html:function(){return"<p>Side 5.</p><button>Click me</button>"},onload:function(t){n("button",t).forEach(function(t){t.addEventListener("click",function(){i.global.useMessaging&&r.post("btn_interaction")})})}},{html:function(){return"<p>Side 6.</p><button>Click me</button>"},onload:function(t){n("button",t).forEach(function(t){t.addEventListener("click",function(){i.global.useMessaging&&r.post("btn_interaction")})})}}]};e.exports=o},{"../../config":46,"../../messaging":56,"../../utilities":59}],49:[function(t,e){var n=t("../utilities"),i=t("./common"),r=t("./content"),o=t("../config"),s=t("../assetmanager"),a=Object.create(i);a.init=function(t,e,n,r,o,s){this.parent=s,this.parentID=s.id,i.init.apply(this,arguments),this.element.setAttribute("parent",this.parentID),this.translate.Z=this.width/2,this.renderedZ=this.rotation.Z},a.getElement=function(){return this.populateElement(n.getElement("div","side no"+(this.index+1),{index:this.index},{width:this.width+"px",height:this.height+"px"}))},a.populateElement=function(t){var e=r.sides[this.index];if(this.parent.config.useBackgrounds){var i=new Image,a=this.parent.config.cropLargeFaces?"main":this.name,c=o.global.isCeltra?"http://labs.f5.io/essence/"+r.background:r.background,u=n.format(c,{i:this.index+1,name:a});i.src=s.get(u).uri(),i.width=this.width,i.height=this.height,this.parent.config.cropLargeFaces&&(i.width*=2,i.height*=2,i.style.left=n.isOdd(this.parent.index)?-this.width+"px":0,i.style.top=this.parent.index<2?0:-this.height+"px"),t.appendChild(i)}if(this.parent.config.useContent){var l=document.createElement("span");l.className="content",l.innerHTML=e.html(this.parent.config),t.appendChild(l),e.onload(t,this.parent.config)}var h=document.createElement("div");return h.className="shadow",h.style.width=this.width+"px",h.style.height=this.height+"px",t.appendChild(h),t},a.changeContent=function(t){t=t>=r.sides.length?0:t;var e=r.sides[t];if(this.parent.config.useBackgrounds){var i=n("img",this.element)[0],o=n.format(r.background,{i:t+1,name:this.name});i.src=s.get(o).uri()}if(this.parent.config.useContent){var a=n(".content",this.element)[0];a.innerHTML=e.html(this.parent.config),e.onload(this.element,this.parent.config)}return t},a.render=function(){this.renderedZ=this.rotation.Z,i.render.apply(this)},e.exports=a},{"../assetmanager":41,"../config":46,"../utilities":59,"./common":47,"./content":48}],50:[function(t,e){var n=t("../utilities"),i=t("./content"),r=t("../config"),o=t("./vect3"),s=t("../assetmanager"),a=t("interpol"),c={init:function(t,e){function c(){for(var t=0;4>t;t++){var e={left:n.isEven(t)?0:this.width+"px",top:t>1?this.height+"px":0,width:this.width+"px",height:this.height+"px"},o=0===t?"50% 100%":1===t?"0 50%":2===t?"100% 50%":"50% 0",a=2>t?-91:91,c=0===t||3===t?"X":"Y";e[n.CSS_TRANSFORM_ORIGIN]=o,e[n.CSS_TRANSFORM]="rotate"+c+"("+a+"deg)";var u=n.getElement("div","fold",{},e),l=new Image,h=r.global.isCeltra?"http://labs.f5.io/essence/"+i.background:i.background,f={i:this.faceIndex+1};f.name=this.cube.config.cropLargeFaces?"main":"cube0"+(t+1);var d=n.format(h,f);l.src=s.get(d).uri(),l.width=this.width,l.height=this.height,this.cube.config.cropLargeFaces&&(l.width*=2,l.height*=2,l.style.left=n.isOdd(t+1)?0:-this.width+"px",l.style.top=2>t?0:-this.height+"px"),u.appendChild(l);
var p=n.getElement("div","shadow",{},{});u.appendChild(p),this.element.appendChild(u),this.folds.push({start:a,axis:c,element:u,shadow:p})}}function u(){var t=this,e=[0,1,3,2,0,1,3,2];e=e.splice(e.indexOf(this.cubeIndex),4),e.forEach(function(e,i,s){var c=t.folds[e];if(0===i)return c.element.style[n.CSS_TRANSFORM]="rotate"+c.axis+"(0deg)",void(c.shadow.style.opacity=0);var u=200,l=i*u;a.tween().from(c.start).to(0).delay(l).duration(u).step(function(e){if(c.element.style[n.CSS_TRANSFORM]="rotate"+c.axis+"("+e+"deg)",!r.global.useDynamicLighting)return void(c.shadow.style.opacity=0);var i=n.getTransform(c.element),s=o.rotate(t.lightTransform.translate,o.muls(i.rotate,-1)),a=n.computeVertexData(c.element),u=o.divs(o.sub(a.c,a.a),2),l=o.normalize(o.cross(o.sub(a.b,a.a),o.sub(a.c,a.a))),h=o.normalize(o.sub(s,u)),f=.75-Math.max(0,o.dot(l,h)).toFixed(3);c.light!==f&&(c.light=f,c.shadow.style.opacity=f)}).complete(function(){i===s.length-1&&n.emitter.emit("fold_out_complete",t.cubeRotation)}).start(function(){n.emitter.emit("fold_out_start",e,.5*u)})})}this.width=t.width,this.height=t.height,this.target=t.target,this.faceIndex=e,this.cubeIndex=t.index,this.cubeRotation=t.rotation,this.cube=t,this.folds=[];var l={width:2*this.width+"px",height:2*this.height+"px"};l[n.CSS_TRANSFORM]="translateZ("+Math.ceil(this.width/2)+"px)",this.light=n('[role="light"]')[0],this.lightTransform=n.getTransform(this.light),this.element=n.getElement("div","fold-container",{},l),this.target.appendChild(this.element),c.call(this),u.call(this)}};e.exports=c},{"../assetmanager":41,"../config":46,"../utilities":59,"./content":48,"./vect3":54,interpol:2}],51:[function(t,e){var n=t("../utilities"),i=t("./common"),r=t("./matrix"),o=t("./face"),s=t("./shadow"),a=t("./fold"),c=t("../config"),u=t("interpol"),l=t("../assetmanager"),h=t("./vect3"),f=Object.create(i);f.getElement=function(){return n.getElement("div","cube",{index:this.index},{width:this.width+"px",height:this.height+"px"})},f.init=function(t,e,f,d,p,v){function m(t){A.nextFaceIndex=0,A.faces.forEach(function(t){t.remove()});var e;t&&(e=n.clone(A.rotation),A.rotation={X:0,Y:0,Z:0},A.render()),A.faces=[];for(var i=0;6>i;i++){var r=Object.create(o);r.init(A.width,A.height,i,A.name,A.element,A),A.config.isSequential&&r.changeContent(A.currentContent),r.rotation.Y=1===i?180:2===i?90:3===i?-90:0,r.rotation.X=4===i?90:5===i?-90:0,r.render(),A.faces.push(r)}A.faceData=A.faces.map(function(t){return n(".shadow",t.element)[0]}).map(function(t){var e=n.computeVertexData(t);return t.style.opacity=0,{verticies:e,normal:h.normalize(h.cross(h.sub(e.b,e.a),h.sub(e.c,e.a))),center:h.divs(h.sub(e.c,e.a),2),elem:t}}),t&&e&&(A.rotation=e,A.render())}function _(){A.faces.forEach(function(t){t.rotation.Z=0,t.render()})}function g(){te=n.emitter.on(A.id,function(t){te&&(te=te()),y(t)})}function y(t){A.element.removeEventListener("touchstart",y);var e=t.changedTouches[0];S=e.clientX,P=e.clientY,M=Date.now(),O=S,I=P,Y=G=!1,velocity=q=0,X?(X.pause(),Z=X):($=j(t.target),A.config.isSequential&&(A.currentContent++,A.faces.filter(function(t){return t.index!==$.index}).forEach(function(t){A.currentContent=t.changeContent(A.currentContent)}))),B=n.clone(A.rotation),D=E(B),document.addEventListener("touchmove",b),document.addEventListener("touchend",w)}function b(t){te&&(te=te()),t.preventDefault();var e=t.changedTouches[0];z=e.clientX<O?"left":"right",N=e.clientY<I?"up":"down",O=e.clientX,I=e.clientY;var i=document.elementFromPoint(O,I),r=x(i);if(r){var o=r.getAttribute("parent");if(o!==A.id){var s=function(){n.emitter.emit(o,n.extend({},t,{target:i}))};return void w(n.extend({},t,{onAnimComplete:s}))}}else if(!A.config.useInertia)return void w(t);var a=(S-O)/(A.width/90),l=(P-I)/(A.height/90),h=Math.abs(a),f=Math.abs(l);Math.max(h,f)<1||(n.isDefined(L)||(V=h>f?"leftright":"updown",L="leftright"===V?D.LR:D.UD,k($,V)),U=H,H="leftright"===V?z:N,U!==H&&(G=!0,W=Date.now(),Q=O,K=I),J=Date.now(),Y=!0,q="leftright"===V?a:l,q=C(q),u.pipeline.has("render"+A.id)||u.pipeline.add("render"+A.id,function(){var t=A.rotation[L],e=Math.round(B[L]+q),i=n.nearest(e,90),r=n.nearest(t,90);if(i!==r&&c.global.useSound&&A.sound.play(),A.rotation[L]=e,A.render(),A.config.castShadow)if("leftright"===V)A.shadow.rotation.Z=C(e),A.shadow.render();else if("updown"===V){var o=Math.abs(e-i)/45,s=1+o*A.shadow.hypRatio/2,a=Math.abs(A.shadow.rotation.Z);A.shadow.scale.X=90===a||270===a?s:1,A.shadow.scale.Y=0===a||180===a?s:1,A.shadow.render()}}))}function w(t){if(document.removeEventListener("touchmove",b),document.removeEventListener("touchend",w),A.config.isSequential&&Y||(A.element.addEventListener("touchstart",y),g()),!Y)return void(Z&&(Z.play(),Z=void 0));u.pipeline.has("render"+A.id)&&u.pipeline.remove("render"+A.id);var e=t.changedTouches[0],i=Date.now(),r=e.clientX,o=e.clientY,s=r-Q,a=o-K,l="leftright"===V?s:a,h=i-W;l=0>l&&("right"===H||"down"===H)?Math.abs(l):l,l=l>0&&("left"===H||"up"===H)?-l:l;var f=l/h,d=Math.abs(l)<.8*A.width/2?1:0,p=B[L],v=A.rotation[L],m=n.nearest(v,90),_=1;if(A.config.useInertia&&Math.abs(f)>.8){var j=0>f?"min":"max",x=0>f?-d:d,E=Math.round(2*f);m-=C(90*Math[j](x,E)),_=Math.abs(m-v)/90}else{var k=n.nearest(p,90);m="up"===H||"left"===H?k+C(90):k-C(90)}var R,S=v,P=m,M="onAnimComplete"in t?100:300,O=!1;X=u.tween().from(S).to(P).duration(Math.round(M*_)).ease(u.easing.easeOutCirc).step(function(e){R=R||e;var i=n.nearest(e,90),r=n.nearest(R,90);if(i!==r&&c.global.useSound&&A.sound.play(),A.rotation[L]=e,A.render(),R=e,A.config.castShadow)if("leftright"===V)A.shadow.rotation.Z=C(e),A.shadow.render();else if("updown"===V){var o=Math.abs(e-i)/45,s=1+o*A.shadow.hypRatio/2,a=Math.abs(A.shadow.rotation.Z);A.shadow.scale.X=90===a||270===a?s:1,A.shadow.scale.Y=0===a||180===a?s:1,A.shadow.render()}if("onAnimComplete"in t){var u=Math.abs(P-e);10>=u&&!O&&(O=!0,t.onAnimComplete())}}).complete(function(t){var e=n.norm(n.nearest(t,90)%360);A.rotation[L]=e,A.render(),A.config.castShadow&&("leftright"===V?(A.shadow.rotation.Z=C(e),A.shadow.render()):"updown"===V&&(A.shadow.scale.X=A.shadow.scale.Y=1,A.shadow.render())),T(),A.config.isSequential&&(A.element.addEventListener("touchstart",y),g()),L=void 0,H=void 0,X=void 0,F(A.rotation)}).start()}function j(t){var e=x(t);return n.isDefined(e)?A.faces[parseInt(e.getAttribute("index"),10)]:void 0}function x(t){for(var e=t;null!==e&&!/side/.test(e.className);)e=e.parentNode;return null!==e&&n.isDefined(e)?e:void 0}function E(t){var e=n.norm(n.nearest(t.X,90)%360),i=n.norm(n.nearest(t.Y,90)%360),r=90===e||270===e?"Z":"Y",o=90===i||270===i?"Z":"X",s=["X","Y","Z"].filter(function(t){return t!==r&&t!==o})[0];return{LR:r,UD:o,Mid:s}}function F(t,e){if(A.config.normaliseFacialRotation||"undefined"!=typeof e){var i=n.norm(n.nearest(t.X,90)%360),o=n.norm(n.nearest(t.Y,90)%360),s=n.norm(n.nearest(t.Z,90)%360);if("undefined"!=typeof e&&e!==!0)return r[e][i][o][s];for(var a=A.faces.length-1;a>=0;a--){var c=A.faces[a];c.rotation.Z=r[a][i][o][s],c.render()}}}function k(t,e){if(A.config.normaliseFacialRotation&&"updown"===e){var i=n.isEven(t.index)?t.index+1:t.index-1,r=A.faces[i];r.rotation.Z=r.renderedZ+180,r.render()}}function C(t){var e=n.norm(n.nearest(A.rotation.X,90)%360),i=n.norm(n.nearest(A.rotation.Y,90)%360);return"leftright"===V?180===e&&"Y"===L||90===e&&0===i||270===e&&("Z"!==L||180===i)?t:-t:270===i?-t:t}function T(){c.global.useGamification&&n.emitter.emit("rotation_complete")}i.init.apply(this,arguments),this.config=n.extend({},c.cube,v);var R="assets/sound/click.mp3";R=c.global.isCeltra?"http://labs.f5.io/essence/"+R:R,this.sound=l.get(R),this.currentContent=0,this.nextFaceIndex=0,this.faces=[],this.faceData=[],this.shadow=Object.create(s),this.shadow.init(this.width,this.height,this.index,this.name,this.target.parentNode,this),this.shadow.opacity=this.config.castShadow?this.shadow.opacity:0,this.shadow.render(),this.light=n('[role="light"]')[0],this.lightTransform=n.getTransform(this.light);var A=this;m(),this.target.style[n.CSS_TRANSFORM]="translateZ(-"+this.width/2+"px)",this.element.addEventListener("touchstart",y),c.global.useGamification&&this.element.addEventListener("doubletap",function(t){var e=j(t.target),n=Object.create(a);n.init(A,e.index)}),this.getFaceFromTarget=j,this.getNormalisedFaceRotation=F,this.rerenderFaces=m.bind(this,!0),this.resetNormalisedFaces=_,this.getAxisDefinition=E;var S,P,M,O,I,D,L,V,z,N,H,U,B,q,Y,G,X,Z,$,W,Q,K,J,te;document.addEventListener("touchstart",g),document.addEventListener("touchend",function(){te&&te()})},f.render=function(){if(i.render.call(this),!c.global.useDynamicLighting)return void this.faceData.forEach(function(t){t.elem.style.opacity=0});for(var t,e,r,o=0,s=this.faceData.length,a=n.getTransform(this.element),u=h.rotate(this.lightTransform.translate,h.muls(a.rotate,-1));++o<s;)t=this.faceData[this.nextFaceIndex],e=h.normalize(h.sub(u,t.center)),r=1-Math.max(0,h.dot(t.normal,e)).toFixed(3),t.light!=r&&(t.light=r,t.elem.style.opacity=r),this.nextFaceIndex=(this.nextFaceIndex+1)%s},e.exports=f},{"../assetmanager":41,"../config":46,"../utilities":59,"./common":47,"./face":49,"./fold":50,"./matrix":52,"./shadow":53,"./vect3":54,interpol:2}],52:[function(t,e){e.exports={0:{0:{0:{0:0,90:270,180:180,270:90},90:{0:0,90:270,180:180,270:90},180:{0:0,90:270,180:180,270:90},270:{0:0,90:270,180:180,270:90}},90:{0:{0:0,90:270,180:180,270:90},90:{0:270,90:180,180:90,270:0},180:{0:180,90:90,180:0,270:270},270:{0:90,90:0,180:270,270:180}},180:{0:{0:180,90:90,180:0,270:270},90:{0:180,90:90,180:0,270:270},180:{0:180,90:90,180:0,270:270},270:{0:180,90:90,180:0,270:270}},270:{0:{0:0,90:270,180:180,270:90},90:{0:90,90:0,180:270,270:180},180:{0:180,90:90,180:0,270:270},270:{0:270,90:180,180:90,270:0}}},1:{0:{0:{0:0,90:90,180:180,270:270},90:{0:0,90:90,180:180,270:270},180:{0:0,90:90,180:180,270:270},270:{0:0,90:90,180:180,270:270}},90:{0:{0:180,90:270,180:0,270:90},90:{0:90,90:180,180:270,270:0},180:{0:0,90:90,180:180,270:270},270:{0:270,90:0,180:90,270:180}},180:{0:{0:180,90:270,180:0,270:90},90:{0:180,90:270,180:0,270:90},180:{0:180,90:270,180:0,270:90},270:{0:180,90:270,180:0,270:90}},270:{0:{0:180,90:270,180:0,270:90},90:{0:270,90:0,180:90,270:180},180:{0:0,90:90,180:180,270:270},270:{0:90,90:180,180:270,270:0}}},2:{0:{0:{0:0,90:270,180:180,270:90},90:{0:0,90:180,180:180,270:180},180:{0:0,90:90,180:180,270:270},270:{0:0,90:0,180:180,270:0}},90:{0:{0:270,90:270,180:270,270:270},90:{0:180,90:180,180:180,270:0},180:{0:90,90:90,180:90,270:90},270:{0:0,90:0,180:0,270:180}},180:{0:{0:180,90:270,180:0,270:90},90:{0:180,90:180,180:0,270:180},180:{0:180,90:90,180:0,270:270},270:{0:180,90:0,180:0,270:0}},270:{0:{0:90,90:90,180:90,270:90},90:{0:180,90:0,180:180,270:180},180:{0:270,90:270,180:270,270:270},270:{0:0,90:180,180:0,270:0}}},3:{0:{0:{0:0,90:270,180:180,270:90},90:{0:0,90:0,180:180,270:0},180:{0:0,90:90,180:180,270:270},270:{0:0,90:180,180:180,270:180}},90:{0:{0:90,90:90,180:90,270:90},90:{0:0,90:180,180:0,270:0},180:{0:270,90:270,180:270,270:270},270:{0:180,90:0,180:180,270:180}},180:{0:{0:180,90:270,180:0,270:90},90:{0:180,90:0,180:0,270:0},180:{0:180,90:90,180:0,270:270},270:{0:180,90:180,180:0,270:180}},270:{0:{0:270,90:270,180:270,270:270},90:{0:0,90:0,180:0,270:180},180:{0:90,90:90,180:90,270:90},270:{0:180,90:180,180:180,270:0}}},4:{0:{0:{0:0,90:270,180:180,270:90},90:{0:90,90:270,180:90,270:90},180:{0:180,90:270,180:0,270:90},270:{0:270,90:270,180:270,270:90}},90:{0:{0:180,90:180,180:180,270:180},90:{0:270,90:90,180:90,270:90},180:{0:0,90:0,180:0,270:0},270:{0:90,90:270,180:270,270:270}},180:{0:{0:0,90:90,180:180,270:270},90:{0:90,90:90,180:90,270:270},180:{0:180,90:90,180:0,270:270},270:{0:270,90:90,180:270,270:270}},270:{0:{0:0,90:0,180:0,270:0},90:{0:90,90:90,180:270,270:90},180:{0:180,90:180,180:180,270:180},270:{0:270,90:270,180:90,270:270}}},5:{0:{0:{0:0,90:270,180:180,270:90},90:{0:270,90:270,180:270,270:90},180:{0:180,90:270,180:0,270:90},270:{0:90,90:270,180:90,270:90}},90:{0:{0:0,90:0,180:0,270:0},90:{0:270,90:270,180:90,270:270},180:{0:180,90:180,180:180,270:180},270:{0:90,90:90,180:270,270:90}},180:{0:{0:0,90:90,180:180,270:270},90:{0:270,90:90,180:270,270:270},180:{0:180,90:90,180:0,270:270},270:{0:90,90:90,180:90,270:270}},270:{0:{0:180,90:180,180:180,270:180},90:{0:90,90:270,180:270,270:270},180:{0:0,90:0,180:0,270:0},270:{0:270,90:90,180:90,270:90}}}}},{}],53:[function(t,e){var n=t("../utilities"),i=t("./common"),r=(t("../config"),Object.create(i));r.init=function(t,e,n,r,o,s){this.parent=s,this.scale={X:1,Y:1},this.opacity=.1,i.init.apply(this,arguments),this.rotation.X=90,this.translate.Z=-(.8*this.height),this.hypotenuse=Math.sqrt(this.width*this.width+this.height*this.height),this.hypRatio=this.hypotenuse/this.width-1},r.getElement=function(){var t=1.5,e="25px";return n.getElement("div","cube-shadow",{},{width:this.width/t+"px",height:this.height/t+"px",borderRadius:e})},r.render=function(){i.render.apply(this),this.element.style[n.CSS_TRANSFORM]+=" scale("+this.scale.X+","+this.scale.Y+")",this.element.style.opacity=this.opacity},e.exports=r},{"../config":46,"../utilities":59,"./common":47}],54:[function(t,e){var n={create:function(t,e,n){return{x:t||0,y:e||0,z:n||0}},add:function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},sub:function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},mul:function(t,e){return{x:t.x*e.x,y:t.y*e.y,z:t.z*e.z}},div:function(t,e){return{x:t.x/e.x,y:t.y/e.y,z:t.z/e.z}},muls:function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},divs:function(t,e){return{x:t.x/e,y:t.y/e,z:t.z/e}},len:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},dot:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},cross:function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},normalize:function(t){return n.divs(t,n.len(t))},ang:function(t,e){return Math.acos(n.dot(t,e)/(n.len(t)*n.len(e)))},copy:function(t){return{x:t.x,y:t.y,z:t.z}},equal:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},rotate:function(t,e){var n=t.x,i=t.y,r=t.z,o=e.x/2,s=e.y/2,a=e.z/2,c=Math.cos(o),u=Math.cos(s),l=Math.cos(a),h=Math.sin(o),f=Math.sin(s),d=Math.sin(a),p=c*u*l+-h*f*d,v=h*u*l- -c*f*d,m=c*f*l+h*u*-d,_=c*u*d- -h*f*l,g=1-2*(m*m+_*_),y=2*(v*m+_*p),b=2*(v*_-m*p),w=2*(v*m-_*p),j=1-2*(v*v+_*_),x=2*(_*m+v*p),E=2*(v*_+m*p),F=2*(m*_-v*p),k=1-2*(v*v+m*m);return{x:n*g+i*w+r*E,y:n*y+i*j+r*F,z:n*b+i*x+r*k}}};e.exports=n},{}],55:[function(t,e){function n(){i();var t=s('[role="debug"]')[0],e=document.createElement("div");e.className="close",e.addEventListener("tap",function(){t.classList.add("hidden"),document.addEventListener("touchmove",s.prevent),s.emitter.emit("debug_panel",!1)});var n=document.createElement("div");n.className="open",n.innerHTML="<span></span>",n.addEventListener("tap",function(){t.classList.remove("hidden"),document.removeEventListener("touchmove",s.prevent),s.emitter.emit("debug_panel",!0)});var r=document.createElement("div");r.className="main",t.appendChild(e),t.appendChild(n),t.appendChild(r);var c=document.createElement("h1");c.innerText="Cube Properties",r.appendChild(c),o=document.createElement("ul"),r.appendChild(o);var u=document.createElement("h1");u.innerText="Global Properties",r.appendChild(u);var l=document.createElement("ul");Object.keys(a.global).forEach(function(t){var e=document.createElement("li"),n=document.createElement("input");n.type="checkbox",n.id=t,a.global[t]&&n.setAttribute("checked",!0),n.addEventListener("change",function(e){a.global[t]=e.target.checked});var i=document.createElement("label");i.setAttribute("for",t),i.innerHTML="<h1>"+a.titles[t]+"</h1><p>"+a.descriptions[t]+"</p>",e.appendChild(n),e.appendChild(i),l.appendChild(e)}),r.appendChild(l),s.emitter.on("global_config_change",function(t,e){var n=s("input#"+t,r)[0];n.checked=e?!0:!1})}function i(){function t(){n.update(),i.update()}var e=s('[role="metrics"]')[0],n=new c;n.domElement.style.position="absolute",n.domElement.style.right="0px",n.domElement.style.bottom="0px";var i=new c;i.setMode(1),i.domElement.style.position="absolute",i.domElement.style.right="80px",i.domElement.style.bottom="0px",e.appendChild(n.domElement),e.appendChild(i.domElement),n.domElement.style.display=a.global.displayMetrics?"block":"none",i.domElement.style.display=a.global.displayMetrics?"block":"none",a.global.displayMetrics&&u.pipeline.add("stats",t),s.emitter.on("global_config_change",function(e,r){"displayMetrics"===e&&(n.domElement.style.display=r?"block":"none",i.domElement.style.display=r?"block":"none",u.pipeline[r?"add":"remove"]("stats",t))})}function r(t){if(o){o.innerHTML="";var e=t.map(function(t){return t.config});Object.keys(e[0]).forEach(function(n){var i=document.createElement("li"),r=document.createElement("input");r.type="checkbox",r.id=n,e[0][n]&&r.setAttribute("checked",!0),r.addEventListener("change",function(i){var r=i.target.checked;switch(e.forEach(function(t){"useVideo"!==n&&"useGif"!==n||!r||(t.useContent=!0,s("input#useContent",o)[0].checked=!0),"useContent"!==n||r||(t.useVideo=t.useGif=!1,s("input#useVideo",o)[0].checked=!1,s("input#useGif",o)[0].checked=!1),"isSequential"===n&&r&&(t.useInertia=!1,s("input#useInertia",o)[0].checked=!1),t[n]=r}),n){case"normaliseFacialRotation":case"useBackgrounds":case"useContent":case"useVideo":case"useGif":case"isSequential":t.forEach(function(t){t.rerenderFaces(),t.getNormalisedFaceRotation(t.rotation,!0)}),"normaliseFacialRotation"!==n||r||t.forEach(function(t){t.resetNormalisedFaces()})}});var c=document.createElement("label");c.setAttribute("for",n),c.innerHTML="<h1>"+a.titles[n]+"</h1><p>"+a.descriptions[n]+"</p>",i.appendChild(r),i.appendChild(c),o.appendChild(i)})}}var o,s=t("../utilities"),a=t("../config"),c=t("stats"),u=t("interpol");e.exports={init:n,defineCubeProperties:r}},{"../config":46,"../utilities":59,interpol:2,stats:3}],56:[function(t,e){var n,i;window.addEventListener("message",function(t){if(console.log(t),/\.celtra/.test(t.origin))switch(n&&i||(n=t.source,i=t.origin),t.data){case"init":n.postMessage("received_init",i)}});var r={post:function(t){n&&i&&n.postMessage(t,i)}};e.exports=r},{}],57:[function(t,e){function n(t){console.log("handler"),h.gamma=l.gamma,h.beta=l.beta,l.gamma=u.gamma-t.gamma,l.beta=u.beta-t.beta}function i(){var t=1/60,e=.3,n=t/(e+t),i=n*l.beta+(1-n)*h.beta,r=n*l.gamma+(1-n)*h.gamma;i*=.5,r*=.5,s.style[a.CSS_TRANSFORM]="rotateX("+i.toFixed(3)+"deg) rotateY("+r.toFixed(3)+"deg)"}function r(t){window.addEventListener("deviceorientation",function e(n){u.gamma=n.gamma,u.beta=n.beta,window.removeEventListener("deviceorientation",e),t&&t()})}function o(t){return console.log("orient"),s=t,r(),o}var s,a=t("../utilities"),c=t("interpol"),u={gamma:0,beta:0},l={gamma:0,beta:0},h={gamma:0,beta:0};o.listen=function(){return console.log("orient listen"),window.addEventListener("deviceorientation",n),c.pipeline.add("orient",i),o},o.detach=function(){return window.removeEventListener("deviceorientation",n),c.pipeline.remove("orient"),o},o.reset=function(t){return r(t),o},e.exports=o},{"../utilities":59,interpol:2}],58:[function(t,e){var n=t("../utilities"),i=t("../cube/vect3"),r={init:function(t){this.element=t,this.translate={X:0,Y:0,Z:0},this.rotation={X:0,Y:0,Z:0},this.scale={X:1,Y:1},this.nextFaceIndex=0,this.light=n('[role="light"]')[0],this.lightTransform=n.getTransform(this.light),this.faces=n(".face",t),this.faceData=this.faces.map(function(t){var e=n(".shadow",t),i=n(".highlight",t),r={face:t};return i.length&&(r.highlight=i[0]),e.length&&(r.shadow=e[0]),r}).map(function(t){var e=n.computeVertexData(t.face);return"highlight"in t&&(t.highlight.style.opacity=0),"shadow"in t&&(t.shadow.style.opacity=0),n.extend(t,{verticies:e,normal:i.normalize(i.cross(i.sub(e.b,e.a),i.sub(e.c,e.a))),center:i.divs(i.sub(e.c,e.a),2)})}),this.render()},render:function(){this.element.style[n.CSS_TRANSFORM]="rotateX("+this.rotation.X+"deg) rotateY("+this.rotation.Y+"deg) rotateZ("+this.rotation.Z+"deg) translateX("+this.translate.X+"px) translateY("+this.translate.Y+"px) translateZ("+this.translate.Z+"px) scale("+this.scale.X+","+this.scale.Y+")";for(var t,e,r,o=0,s=this.faceData.length,a=n.getTransform(this.element),c=i.rotate(this.lightTransform.translate,i.muls(a.rotate,-1));++o<s;){if(t=this.faceData[this.nextFaceIndex],e=i.normalize(i.sub(c,t.center)),r=1-Math.max(0,i.dot(t.normal,e)).toFixed(3),t.light!=r){t.light=r,"shadow"in t&&(t.shadow.style.opacity=r);var u=1-2*r;"highlight"in t&&(t.highlight.style.opacity=u,t.highlight.style[n.CSS_TRANSFORM]="translateZ(2px) scaleY("+1.2*u+")")}this.nextFaceIndex=(this.nextFaceIndex+1)%s}}};e.exports=r},{"../cube/vect3":54,"../utilities":59}],59:[function(t,e){function n(t){var e=document.createElement("div"),n=null;return t.forEach(function(t){"undefined"!=typeof e.style[t]&&(n=t)}),n}function i(t){var e=t.charAt(0).toUpperCase()+t.substring(1),i=" ms Moz Webkit O".split(" ").map(function(n){return""===n?t:n+e});return n(i)}function r(t,e){return Array.prototype.slice.call((e||u).querySelectorAll(t))}function o(t){var e,n=t.split(/\s*[(),]\s*/).slice(1,-1);return e=6===n.length?{m11:+n[0],m21:+n[2],m31:0,m41:+n[4],m12:+n[1],m22:+n[3],m32:0,m42:+n[5],m13:0,m23:0,m33:1,m43:0,m14:0,m24:0,m34:0,m44:1}:16===n.length?{m11:+n[0],m21:+n[4],m31:+n[8],m41:+n[12],m12:+n[1],m22:+n[5],m32:+n[9],m42:+n[13],m13:+n[2],m23:+n[6],m33:+n[10],m43:+n[14],m14:+n[3],m24:+n[7],m34:+n[11],m44:+n[15]}:{m11:1,m21:0,m31:0,m41:0,m12:0,m22:1,m32:0,m42:0,m13:0,m23:0,m33:1,m43:0,m14:0,m24:0,m34:0,m44:1}}function s(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}}function a(t,e){var n=t.x,i=t.y,r=t.z,o=e.x/2,s=e.y/2,a=e.z/2,c=Math.cos(o),u=Math.cos(s),l=Math.cos(a),h=Math.sin(o),f=Math.sin(s),d=Math.sin(a),p=c*u*l+-h*f*-d,v=h*u*l- -c*f*-d,m=c*f*l+h*u*d,_=c*u*d- -h*f*-l,g=1-2*(m*m+_*_),y=2*(v*m+_*p),b=2*(v*_-m*p),w=2*(v*m-_*p),j=1-2*(v*v+_*_),x=2*(_*m+v*p),E=2*(v*_+m*p),F=2*(m*_-v*p),k=1-2*(v*v+m*m);return{x:n*g+i*w+r*E,y:n*y+i*j+r*F,z:n*b+i*x+r*k}}var c=window,u=document;r.ready=function(t){return"complete"===u.readyState?setTimeout(t,1):void c.addEventListener("DOMContentLoaded",t)},r.extend=function(){for(var t=[].slice.call(arguments),e=t[0],n=1,i=t.length;i>n;n++){var r=t[n];for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])}return e},r.clone=function(t){return r.extend({},t)},r.norm=function(t){return t>=0?t:360-Math.abs(t)},r.deg2rad=function(t){return.017453292519943295*t},r.rad2deg=function(t){return 57.29577951308232*t},r.prevent=function(t){t.preventDefault()},r.format=function(t,e){return t.toString().replace(/\{([^}]+)\}/g,function(t,n){return e[n]})},r.range=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},r.floatRange=function(t,e){return Math.random()*(e-t)+t},r.nearest=function(t,e){return Math.round(t/e)*e},r.isEven=function(t){return t%2===0},r.isOdd=function(t){return t%2!==0},r.isDefined=function(t){return void 0!==t},r.getElement=function(t,e,n,i){var r=u.createElement(t);return r.className=e,Object.keys(n).forEach(function(t){r.setAttribute(t,n[t])}),Object.keys(i).forEach(function(t){r.style[t]=i[t]}),r},r.getRandomRotation=function(t){return t=t||[0,90,180,270],t[r.range(0,t.length-1)]},r.emitter=function(){function t(){var t=[].slice.call(arguments),e=t[0],i=t[1],o=t[2]||r;n[e]=n[e]||[],n[e].push({fn:i,scope:o});var s=n[e].length-1;return function(){n[e].splice(s,1)}}function e(){var t=[].slice.call(arguments),e=t[0],i=t.slice(1);e in n&&n[e].forEach(function(t){t.fn.apply(t.scope,i)})}var n={};return{on:t,emit:e}}(),r.windowWidth=function(){if("undefined"!=typeof c.innerWidth)return function(){return c.innerWidth};var t="clientWidth"in u.documentElement?u.documentElement:u.body;return function(){return t.clientWidth}}(),r.windowHeight=function(){if("undefined"!=typeof c.innerHeight)return function(){return c.innerHeight};var t="clientHeight"in u.documentElement?u.documentElement:u.body;return function(){return t.clientHeight}}(),r.CSS_TRANSFORM=i("transform"),r.CSS_TRANSFORM_ORIGIN=i("transformOrigin"),r.CSS_PERSPECTIVE=i("perspective"),r.computeVertexData=function(t){for(var e,n=t.offsetWidth,i=t.offsetHeight,o={a:{x:-n/2,y:-i/2,z:0},b:{x:n/2,y:-i/2,z:0},c:{x:n/2,y:i/2,z:0},d:{x:-n/2,y:i/2,z:0}};1===t.nodeType;)e=r.getTransform(t),o.a=s(a(o.a,e.rotate),e.translate),o.b=s(a(o.b,e.rotate),e.translate),o.c=s(a(o.c,e.rotate),e.translate),o.d=s(a(o.d,e.rotate),e.translate),t=t.parentNode;return o},r.getTransform=function(t){var e,n,i=getComputedStyle(t,null)[r.CSS_TRANSFORM],s=o(i),a=Math.asin(-s.m13);return e=Math.atan2(s.m23,s.m33),n=Math.atan2(s.m12,s.m11),{transformStyle:i,matrix:s,rotate:{x:e,y:a,z:n},translate:{x:s.m41,y:s.m42,z:s.m43}}},function(){if(u.addEventListener){var t,e,n=function(t,e){var n=u.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,t.target),t.target.dispatchEvent(n)||n.preventDefault(),n=null,!1},i=!0,r={x:0,y:0},o={x:0,y:0},s={touchstart:function(t){r.x=t.touches[0].pageX,r.y=t.touches[0].pageY},touchmove:function(t){i=!1,o.x=t.touches[0].pageX,o.y=t.touches[0].pageY},touchend:function(s){if(i){if(n(s,"fastclick"),n(s,"tap"),s.target===t){var a=Date.now()-e;500>a&&n(s,"doubletap")}t=s.target,e=Date.now()}else{var c=o.x-r.x,u=Math.abs(c),l=o.y-r.y,h=Math.abs(l);Math.max(u,h)>20&&(n(s,u>h?0>c?"swipeleft":"swiperight":0>l?"swipeup":"swipedown"),i=!0)}},touchcancel:function(){i=!1}};for(var a in s)u.addEventListener(a,s[a])}}(),e.exports=r},{}]},{},[1]);